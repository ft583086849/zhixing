# ğŸ“Š è®¢å•ç³»ç»Ÿå­—æ®µå¯¹æ¯”åˆ†æ

> åˆ›å»ºæ—¶é—´ï¼š2025-08-15
> ç›®çš„ï¼šå¯¹æ¯”åå°è®¢å•ç®¡ç†é¡µé¢æ˜¾ç¤ºçš„å­—æ®µä¸æ•°æ®åº“å®é™…å­˜å‚¨çš„å­—æ®µ

## ä¸€ã€è®¢å•ç®¡ç†é¡µé¢æ˜¾ç¤ºçš„å­—æ®µ

### å‰ç«¯AdminOrders.jsä¸­å±•ç¤ºçš„åˆ—ï¼š
1. **ç”¨æˆ·å¾®ä¿¡å·** - customer_wechat âœ…
2. **é”€å”®ç±»å‹** - é€šè¿‡é€»è¾‘åˆ¤æ–­ï¼ˆä¸æ˜¯ç›´æ¥å­—æ®µï¼‰âš ï¸
3. **é”€å”®å¾®ä¿¡å·** - ä»å…³è”è¡¨è·å– âš ï¸
4. **ä¸€çº§é”€å”®å¾®ä¿¡** - ä»å…³è”è¡¨è·å– âš ï¸
5. **TradingViewç”¨æˆ·** - tradingview_username âœ…
6. **è´­ä¹°æ—¶é•¿** - duration âœ…
7. **è´­ä¹°æ–¹å¼** - purchase_type âœ…
8. **ç”Ÿæ•ˆæ—¶é—´** - effective_time âœ…
9. **åˆ°æœŸæ—¶é—´** - expiry_time âœ…
10. **åº”ä»˜é‡‘é¢** - amount âœ…
11. **å®ä»˜é‡‘é¢** - alipay_amount/crypto_amount âœ…
12. **ä¸€çº§é”€å”®ä½£é‡‘é¢** - è®¡ç®—å¾—å‡ºï¼ˆamount * 0.4ï¼‰âš ï¸
13. **äºŒçº§åˆ†é”€ä½£é‡‘é¢** - commission_amount âœ…
14. **ä»˜æ¬¾æ–¹å¼** - payment_method âœ…
15. **è®¢å•çŠ¶æ€** - status âœ…
16. **ä»˜æ¬¾æˆªå›¾** - screenshot_data âœ…
17. **é…ç½®ç¡®è®¤æ—¶é—´** - effective_timeï¼ˆé‡å¤ï¼‰âœ…
18. **æ“ä½œ** - æŒ‰é’®æ“ä½œ

## äºŒã€æ•°æ®åº“ordersè¡¨å®é™…å­—æ®µ

### å­˜åœ¨ä¸”ä½¿ç”¨çš„å­—æ®µï¼š
âœ… customer_wechat - å®¢æˆ·å¾®ä¿¡
âœ… tradingview_username - TradingViewç”¨æˆ·å
âœ… amount - è®¢å•é‡‘é¢
âœ… actual_payment_amount - å®é™…æ”¯ä»˜é‡‘é¢
âœ… alipay_amount - æ”¯ä»˜å®é‡‘é¢
âœ… crypto_amount - åŠ å¯†è´§å¸é‡‘é¢
âœ… status - è®¢å•çŠ¶æ€
âœ… payment_method - æ”¯ä»˜æ–¹å¼
âœ… payment_time - æ”¯ä»˜æ—¶é—´
âœ… duration - è®¢é˜…æ—¶é•¿
âœ… purchase_type - è´­ä¹°ç±»å‹
âœ… effective_time - ç”Ÿæ•ˆæ—¶é—´
âœ… expiry_time - åˆ°æœŸæ—¶é—´
âœ… commission_rate - ä½£é‡‘ç‡
âœ… commission_amount - ä½£é‡‘é‡‘é¢
âœ… screenshot_data - æˆªå›¾æ•°æ®
âœ… config_confirmed - é…ç½®ç¡®è®¤

### å­˜åœ¨ä½†é¡µé¢æœªç›´æ¥æ˜¾ç¤ºçš„å­—æ®µï¼š
- id - ä¸»é”®
- order_number - è®¢å•å·
- customer_name - å®¢æˆ·å§“å
- customer_phone - å®¢æˆ·ç”µè¯
- customer_email - å®¢æˆ·é‚®ç®±
- payment_status - æ”¯ä»˜çŠ¶æ€
- sales_code - é”€å”®ä»£ç 
- link_code - é“¾æ¥ä»£ç 
- sales_type - é”€å”®ç±»å‹
- primary_sales_id - ä¸€çº§é”€å”®ID
- secondary_sales_id - äºŒçº§é”€å”®ID
- screenshot_path - æˆªå›¾è·¯å¾„
- created_at - åˆ›å»ºæ—¶é—´
- updated_at - æ›´æ–°æ—¶é—´
- submit_time - æäº¤æ—¶é—´

## ä¸‰ã€é—®é¢˜åˆ†æ

### 1. å­—æ®µå†—ä½™é—®é¢˜
- **screenshot_path** å’Œ **screenshot_data** éƒ½å­˜åœ¨ï¼Œä½†åªç”¨äº†screenshot_data
- **link_code** å­—æ®µå…¨æ˜¯NULLï¼Œå®é™…ç”¨sales_code
- **customer_name/phone/email** åŸºæœ¬ä¸ç”¨ï¼Œåªç”¨customer_wechat

### 2. å…³è”æŸ¥è¯¢é—®é¢˜
é¡µé¢æ˜¾ç¤ºçš„ä»¥ä¸‹ä¿¡æ¯éœ€è¦å…³è”æŸ¥è¯¢ï¼š
- **é”€å”®å¾®ä¿¡å·** - éœ€è¦é€šè¿‡sales_codeæˆ–sales_idå…³è”secondary_salesè¡¨
- **é”€å”®ç±»å‹** - éœ€è¦åˆ¤æ–­é€»è¾‘ï¼Œä¸æ˜¯ç›´æ¥ä»å­—æ®µè·å–
- **ä¸€çº§é”€å”®å¾®ä¿¡** - éœ€è¦é€šè¿‡primary_sales_idå…³è”

### 3. è®¡ç®—å­—æ®µé—®é¢˜
- **ä¸€çº§é”€å”®ä½£é‡‘** - ç¡¬ç¼–ç 40%è®¡ç®—ï¼Œæ²¡æœ‰ä»æ•°æ®åº“è¯»å–
- **é”€å”®ç±»å‹åˆ¤æ–­** - é€šè¿‡å¤æ‚é€»è¾‘åˆ¤æ–­ï¼Œä¸æ˜¯ç›´æ¥å­—æ®µ

## å››ã€ä¼˜åŒ–å»ºè®®

### 1. æ¸…ç†å†—ä½™å­—æ®µ
å»ºè®®åˆ é™¤æˆ–æ ‡è®°ä¸ºåºŸå¼ƒï¼š
- customer_nameï¼ˆç”¨customer_wechatå³å¯ï¼‰
- customer_phoneï¼ˆåŸºæœ¬ä¸ç”¨ï¼‰
- customer_emailï¼ˆåŸºæœ¬ä¸ç”¨ï¼‰
- screenshot_pathï¼ˆç”¨screenshot_dataï¼‰
- link_codeï¼ˆç”¨sales_codeï¼‰

### 2. æ·»åŠ å¿…è¦å­—æ®µ
å»ºè®®åœ¨ordersè¡¨ç›´æ¥å­˜å‚¨ï¼š
```sql
ALTER TABLE orders ADD COLUMN IF NOT EXISTS sales_wechat_name VARCHAR(100);
ALTER TABLE orders ADD COLUMN IF NOT EXISTS primary_sales_wechat_name VARCHAR(100);
ALTER TABLE orders ADD COLUMN IF NOT EXISTS calculated_sales_type VARCHAR(20);
```

### 3. ä¼˜åŒ–å…³è”æŸ¥è¯¢
åˆ›å»ºè§†å›¾ç®€åŒ–æŸ¥è¯¢ï¼š
```sql
CREATE VIEW order_details AS
SELECT 
  o.*,
  s.wechat_name as sales_wechat_name,
  ps.wechat_name as primary_sales_wechat_name,
  CASE 
    WHEN s.sales_type = 'primary' THEN 'primary'
    WHEN s.primary_sales_id IS NOT NULL THEN 'secondary'
    ELSE 'independent'
  END as calculated_sales_type
FROM orders o
LEFT JOIN secondary_sales s ON o.sales_code = s.sales_code
LEFT JOIN secondary_sales ps ON s.primary_sales_id = ps.id;
```

## äº”ã€é”€å”®è¡¨ï¼ˆsecondary_salesï¼‰åˆ†æ

### ä½¿ç”¨çš„å­—æ®µï¼š
âœ… sales_code - é”€å”®ä»£ç 
âœ… wechat_name - å¾®ä¿¡åç§°
âœ… payment_method - æ”¯ä»˜æ–¹å¼
âœ… payment_address - æ”¶æ¬¾åœ°å€
âœ… chain_name - é“¾å
âœ… sales_type - é”€å”®ç±»å‹
âœ… primary_sales_id - ä¸Šçº§é”€å”®ID
âœ… commission_rate - ä½£é‡‘ç‡

### åºŸå¼ƒä½†å­˜åœ¨çš„å­—æ®µï¼š
- name - å§“å
- phone - ç”µè¯
- email - é‚®ç®±
- alipay_account - æ”¯ä»˜å®è´¦å·
- alipay_surname - æ”¯ä»˜å®å§“æ°
- line_address_code - çº¿ä¸Šåœ°å€ç 
- line_name - çº¿å

## å…­ã€ç”¨æˆ·è¡¨åˆ†æ

**é—®é¢˜ï¼šç³»ç»Ÿä¸­æ²¡æœ‰ç‹¬ç«‹çš„ç”¨æˆ·è¡¨ï¼**

å½“å‰ç”¨æˆ·ä¿¡æ¯åˆ†æ•£åœ¨ordersè¡¨ä¸­ï¼š
- customer_wechat - å®¢æˆ·å¾®ä¿¡
- customer_name - å®¢æˆ·å§“åï¼ˆåŸºæœ¬ä¸ç”¨ï¼‰
- tradingview_username - TradingViewç”¨æˆ·å

### å»ºè®®åˆ›å»ºç”¨æˆ·è¡¨ï¼š
```sql
CREATE TABLE customers (
  id SERIAL PRIMARY KEY,
  wechat_name VARCHAR(100) UNIQUE NOT NULL,
  tradingview_username VARCHAR(100),
  total_orders INTEGER DEFAULT 0,
  total_amount DECIMAL(10,2) DEFAULT 0,
  first_order_date TIMESTAMP,
  last_order_date TIMESTAMP,
  status VARCHAR(20) DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## ä¸ƒã€æ€»ç»“ä¸å»ºè®®

### å½“å‰é—®é¢˜ï¼š
1. âŒ **æ²¡æœ‰ç‹¬ç«‹çš„ç”¨æˆ·è¡¨** - ç”¨æˆ·ä¿¡æ¯æ•£è½åœ¨è®¢å•è¡¨ä¸­
2. âš ï¸ **å­—æ®µå†—ä½™** - å¤šä¸ªæœªä½¿ç”¨çš„å­—æ®µ
3. âš ï¸ **å…³è”æŸ¥è¯¢å¤æ‚** - é”€å”®ä¿¡æ¯éœ€è¦å¤šè¡¨å…³è”
4. âš ï¸ **è®¡ç®—é€»è¾‘åˆ†æ•£** - ä½£é‡‘è®¡ç®—ç¡¬ç¼–ç åœ¨å‰ç«¯

### æ”¹è¿›æ–¹æ¡ˆï¼š
1. **åˆ›å»ºcustomersè¡¨** - é›†ä¸­ç®¡ç†ç”¨æˆ·ä¿¡æ¯
2. **æ¸…ç†å†—ä½™å­—æ®µ** - åˆ é™¤æœªä½¿ç”¨çš„å­—æ®µ
3. **ä¼˜åŒ–è¡¨ç»“æ„** - åœ¨ordersè¡¨æ·»åŠ å¸¸ç”¨çš„å…³è”ä¿¡æ¯
4. **åˆ›å»ºè§†å›¾** - ç®€åŒ–å¤æ‚æŸ¥è¯¢
5. **ç»Ÿä¸€è®¡ç®—é€»è¾‘** - ä½£é‡‘è®¡ç®—æ”¾åœ¨æ•°æ®åº“æˆ–åç«¯

### æ•°æ®ä¸€è‡´æ€§åŸåˆ™ï¼š
- **è®¢å•è¡¨**åº”åŒ…å«æ‰€æœ‰è®¢å•ç›¸å…³å­—æ®µ
- **é”€å”®è¡¨**åº”åŒ…å«æ‰€æœ‰é”€å”®äººå‘˜ä¿¡æ¯
- **ç”¨æˆ·è¡¨**åº”åŒ…å«æ‰€æœ‰å®¢æˆ·ä¿¡æ¯
- é¿å…è·¨è¡¨å­˜å‚¨åŒä¸€ç±»ä¿¡æ¯