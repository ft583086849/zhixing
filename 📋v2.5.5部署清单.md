# 📋 v2.5.5 部署清单

## 🚀 版本信息
- **版本号**: v2.5.5
- **发布时间**: 2025-01-11
- **重要等级**: ⭐⭐⭐⭐⭐ 高

## 📦 本次更新内容

### 1️⃣ 订单管理页面优化

#### 新增功能
- ✅ **销售类型列**：明确显示一级销售/二级销售/独立销售

#### 字段调整
| 字段名 | 显示逻辑 | 说明 |
|--------|---------|------|
| 销售类型 | 根据销售身份显示标签 | 一级(蓝)/二级(橙)/独立(绿) |
| 销售微信号 | 显示实际出单人 | 谁卖的就显示谁 |
| 一级销售微信 | 根据类型显示 | 二级显示上级，一级显示自己，独立显示空 |

#### 字段顺序
1. 用户微信号
2. **销售类型**（新增）
3. 销售微信号
4. 一级销售微信号
5. TradingView用户
6. ...其他字段

### 2️⃣ 销售管理页面优化

#### 新增字段（用于打款）
- ✅ **收款链名**：显示TRC20/BSC/支付宝等
- ✅ **收款地址**：显示完整收款地址，支持一键复制

#### 字段位置
在"待返佣状态"之前添加：
1. 收款链名
2. 收款地址
3. 待返佣状态

### 3️⃣ 核心逻辑修复

#### 订单销售归属判断
**修复前**：优先显示一级销售（错误）
**修复后**：显示实际出单的销售（正确）

```javascript
// 正确的判断逻辑
if (二级销售出单) {
  销售微信号 = 二级销售
  一级销售微信 = 其上级
} else if (一级销售出单) {
  销售微信号 = 一级销售
  一级销售微信 = 自己
} else if (独立销售出单) {
  销售微信号 = 独立销售
  一级销售微信 = 空
}
```

### 4️⃣ 关于佣金率

#### 确认的逻辑
- 每个订单总佣金：40%
- 一级自己卖：拿40%
- 二级卖（佣金25%）：二级拿25%，一级拿15%
- 动态佣金率计算：使用一级销售对账页面的数据

## 🔧 修改的文件

```
client/src/components/admin/AdminOrders.js
  - 行214-293: 新增销售类型列，调整销售微信显示逻辑
  
client/src/components/admin/AdminSales.js
  - 行543-611: 新增收款链名和收款地址列
```

## 📊 测试要点

### 1. 订单管理页面
- [ ] 销售类型正确显示（一级/二级/独立）
- [ ] 销售微信号显示实际出单人
- [ ] 一级销售微信根据类型正确显示
- [ ] 字段顺序正确

### 2. 销售管理页面
- [ ] 收款链名正确显示
- [ ] 收款地址可以复制
- [ ] 加密货币地址正确截断显示

### 3. 数据一致性
- [ ] wxq8854订单正确显示Liangjunhao889为销售
- [ ] 佣金率计算正确（不再出现2.5%）

## ⚠️ 注意事项

1. **数据验证**
   - 确认订单的sales_code正确
   - 确认secondary_sales_id和primary_sales_id关联正确

2. **佣金率问题**
   - 如仍显示2.5%，需检查动态计算公式
   - 考虑直接使用一级销售对账页面数据

3. **收款信息**
   - 确保payment_account和payment_method字段有值
   - 加密货币地址注意隐私保护

## 📝 待解决问题

1. **佣金率输入框太小**
   - 需要调整InputNumber组件宽度
   
2. **动态佣金率计算**
   - 考虑移除或修正计算公式
   - 使用一级销售对账页面的数据

## ✅ 部署确认清单

- [ ] 代码已提交到main分支
- [ ] Vercel自动部署成功
- [ ] 订单管理页面显示正确
- [ ] 销售管理页面显示正确
- [ ] 佣金率不再显示异常值
- [ ] 收款信息完整显示

## 📞 问题反馈

如遇问题，请提供：
1. 具体的订单ID
2. 销售微信号
3. 错误截图
