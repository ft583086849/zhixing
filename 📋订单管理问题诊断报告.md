# 📋 订单管理问题诊断报告

## 🔍 问题现状

### 1. 销售微信号显示横线（-）
**现象**：有值但显示为横线
**原因分析**：数据关联字段映射问题
- `SupabaseService.getOrders()` 中关联销售信息的逻辑可能不正确
- 字段名不匹配：`sales_wechat_name` vs `wechat_name`

### 2. 生效时间/到期时间显示横线（-）
**现象**：时间字段为空
**原因分析**：
- 字段可能为NULL或undefined
- 时间格式转换问题
- 字段名不匹配：`effective_time` vs `effectiveTime`

### 3. 订单状态显示英文
**现象**：显示"pending"等英文状态
**原因分析**：
- 状态映射函数未生效
- 数据库中状态值与前端映射不匹配
- 可能的状态值：`pending` vs `pending_payment`

### 4. 数据概览显示0
**现象**：统计数据全为0
**原因分析**：
- `SupabaseService.getOrderStats()` 查询可能失败
- 数据库中没有实际订单数据
- API调用失败或缓存问题

### 5. 销售管理数据为空
**现象**：销售列表无数据
**原因分析**：
- `primary_sales` 和 `secondary_sales` 表为空
- API调用失败
- 数据关联问题

## 🎯 操作按钮修改需求

根据需求文档4.3.1，当前按钮逻辑不符合规范：

### 当前错误逻辑
```javascript
// 当前：所有pending状态都显示相同按钮
case 'pending_payment':
  return 确认付款按钮 + 拒绝按钮
```

### 正确逻辑（需要修改）
```javascript
case 'pending_payment':
  if (record.duration === '7days') {
    // 7天免费：跳过付款，直接进入配置确认
    return 进入配置确认按钮 + 拒绝按钮
  } else {
    // 付费订单：需要付款确认
    return 确认付款按钮 + 拒绝按钮
  }

case 'confirmed_payment':
  return 进入配置确认按钮 + 拒绝按钮

case 'pending_config':
  return 确认配置完成按钮 + 拒绝按钮

case 'confirmed_configuration':
  return 无操作按钮或已完成标识
```

## 📝 修复优先级

1. **高优先级**：
   - 销售微信号字段映射修复
   - 订单状态中文显示修复
   - 操作按钮逻辑修复

2. **中优先级**：
   - 生效时间/到期时间字段修复
   - 数据概览统计修复

3. **低优先级**：
   - 销售管理数据填充
   - 客户管理数据修复

## 🔧 建议修复步骤

1. 先修复字段映射问题（销售微信号）
2. 修复订单状态映射
3. 按需求文档修改操作按钮逻辑
4. 验证数据关联是否正确
5. 检查数据库是否有实际数据
