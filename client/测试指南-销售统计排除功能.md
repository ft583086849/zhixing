# 🧪 销售统计排除功能 - 测试指南

## 📋 功能概述
实现了销售统计排除功能，可以将指定的销售微信号从管理员统计中排除，但不影响销售自己的对账页面。

## ✅ 验证结果
- **代码完整性**: ✅ 所有必要文件已创建
- **语法检查**: ✅ 代码结构正确
- **数据库脚本**: ✅ SQL脚本准备完整
- **服务器状态**: ✅ 开发服务器正在运行 (端口3000)

## 🔧 测试步骤

### 步骤1: 登录管理后台
1. 打开浏览器访问: http://localhost:3000/admin
2. 使用管理员账号登录

### 步骤2: 访问收款配置页面
1. 登录成功后，点击左侧菜单的 **"收款配置"**
2. 页面应该显示原有的收款配置表单
3. 在页面底部应该看到新增的 **"统计排除名单"** 部分

### 步骤3: 测试排除名单UI
检查页面是否显示：
- ✅ "统计排除名单" 标题
- ✅ "添加排除" 按钮  
- ✅ 排除名单表格
- ✅ 统计信息卡片显示影响数据

### 步骤4: 测试添加排除功能
1. 点击 **"添加排除"** 按钮
2. 在弹出的表单中填写：
   - **销售微信号**: "测试销售001"
   - **销售代码**: "TEST001"
   - **销售类型**: 选择 "一级销售"
   - **排除原因**: "测试账号"
3. 点击 **"确定"**
4. 检查是否成功添加到列表中

### 步骤5: 验证统计过滤效果
1. 访问 **数据概览** 页面
2. 查看统计数据（注意记录原始数据）
3. 添加一个有实际数据的销售到排除名单
4. 刷新页面，统计数据应该相应减少
5. 控制台应该显示排除相关的日志信息

### 步骤6: 确认销售对账不受影响
1. 访问: http://localhost:3000/primary-sales-settlement
2. 查询被排除的销售微信号
3. 验证该销售仍能看到完整的数据
4. 数据应该与排除前完全一致

## 📊 预期效果

### ✅ 正常情况
- 收款配置页面正常显示排除管理功能
- 可以成功添加/移除排除销售
- 管理后台统计自动过滤排除的销售数据
- 销售对账页面不受影响，数据完整
- 所有操作都有日志记录

### ❌ 异常处理
- 如果数据库表未创建，会显示相应错误
- 重复添加相同销售会提示
- 网络错误会有友好提示

## 🔍 调试信息

### 浏览器控制台检查
打开浏览器开发者工具，在控制台中执行：

```javascript
// 测试服务连接
import('/src/services/excludedSalesService.js').then(module => {
  const service = module.default;
  service.getExcludedSales().then(list => {
    console.log('✅ 排除名单:', list);
  }).catch(err => {
    console.error('❌ 获取失败:', err);
  });
});
```

### 检查网络请求
- 查看 Network 标签页
- 应该看到对 Supabase 的请求
- 确认请求返回正常状态码

## ⚠️ 重要提醒
1. **数据库准备**: 确保在 Supabase 控制台执行了表创建脚本
2. **测试数据**: 建议使用"测试"开头的微信号进行测试
3. **生产环境**: 测试完成后记得清理测试数据
4. **权限检查**: 确认 Supabase 表权限设置正确

## 🎯 功能特性确认清单
- [ ] 管理后台统计正确排除指定销售
- [ ] 销售对账页面不受排除影响  
- [ ] 可以添加/恢复排除名单
- [ ] 显示排除影响的统计信息
- [ ] 操作有完整的日志记录
- [ ] 界面友好，操作简单

## 🚀 部署前检查
测试通过后，可以按照以下步骤准备部署：
1. 确认所有测试用例通过
2. 清理测试数据
3. 检查代码无编译错误
4. 提交代码更改
5. 部署到生产环境

---

**状态**: ✅ 开发完成，等待用户测试验证
**下一步**: 用户按照上述指南进行功能测试