# 📋 v2.8.0 部署清单

## ⚠️ 部署前必须执行

### 1. Supabase SQL（第一步）
```sql
-- 执行文件：🔧创建收益分配记录表.sql
-- 创建收益分配记录表和初始数据
```

### 2. Supabase SQL（第二步）
```sql
-- 执行文件：🔧修改二级销售默认佣金率为25%.sql
-- 确保二级销售默认佣金率为25%
```

## 🚀 更新内容

### 1. ✅ 待付款确认订单统计优化
- **文件**：`client/src/services/api.js`
- **修改内容**：
  - 7天免费订单不计入"待付款确认订单"
  - 7天免费订单直接计入"待配置确认订单"
- **原因**：7天免费订单不需要付款，不应该在待付款统计中

### 2. ✅ 二级销售佣金率文档更新
- **文件**：
  - `一级销售对账页面过滤逻辑说明.md`
  - `生产环境操作手册.md`
- **修改内容**：默认佣金率从30%改为25%

### 3. 🚧 资金统计收益分配增强（待实施）
- **需求**：
  - 添加"已分配"列（可手动修改）
  - 添加"待分配"列（自动计算）
  - 数据持久化存储
- **状态**：数据库表已创建，前端待实施

## 📊 统计逻辑变化

### 修改前：
```
待付款确认订单 = 所有 pending/pending_payment 状态的订单
待配置确认订单 = pending_config/confirmed_payment 状态的订单
```

### 修改后：
```
待付款确认订单 = pending/pending_payment 状态的订单（排除7天免费）
待配置确认订单 = pending_config/confirmed_payment + 7天免费的pending订单
```

## 🔧 技术细节

### 7天免费订单处理逻辑
```javascript
// 待付款确认（排除7天免费）
const pending_payment_orders = ordersToProcess.filter(order => 
  ['pending_payment', 'pending', 'pending_review'].includes(order.status) &&
  order.duration !== '7days'
).length;

// 待配置确认（包含7天免费）
const pending_config_orders = ordersToProcess.filter(order => 
  ['pending_config', 'confirmed_payment'].includes(order.status) ||
  (order.duration === '7days' && ['pending', 'pending_payment'].includes(order.status))
).length;
```

## 📝 验证清单

- [ ] 创建7天免费订单
  - [ ] 不显示在"待付款确认订单"统计中
  - [ ] 显示在"待配置确认订单"统计中
- [ ] 创建付费订单
  - [ ] 正常显示在"待付款确认订单"统计中
  - [ ] 付款后进入"待配置确认订单"
- [ ] 二级销售默认佣金率
  - [ ] 新创建的二级销售佣金率为25%
  - [ ] waterli_1313显示为25%

## 🌐 测试链接

- 管理员仪表板：https://zhixing-seven.vercel.app/admin/dashboard
- 订单管理：https://zhixing-seven.vercel.app/admin/orders
- 资金统计：https://zhixing-seven.vercel.app/admin/finance
- 销售管理：https://zhixing-seven.vercel.app/admin/sales

## 📅 部署计划

1. **第一阶段（已完成）**：
   - ✅ 修复7天免费订单统计
   - ✅ 更新佣金率文档
   - ✅ 创建数据库表

2. **第二阶段（待实施）**：
   - [ ] 实现收益分配的已分配/待分配功能
   - [ ] 添加手动修改已分配金额功能
   - [ ] 添加分配历史记录

## ⚡ 部署时间

预计部署时间：3-5分钟（Vercel 自动部署）

---

**版本号**：v2.8.0
**部署时间**：2025-01-07
**负责人**：系统管理员
**状态**：部分完成（资金统计功能待实施）
