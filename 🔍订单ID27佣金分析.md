# ğŸ” è®¢å•ID 27ä½£é‡‘è®¡ç®—é—®é¢˜åˆ†æ

## é—®é¢˜æè¿°
- **è®¢å•ID**: 27
- **è®¢å•é‡‘é¢**: 188ç¾å…ƒ
- **æœŸæœ›ä½£é‡‘ç‡**: 0.4 (40%)
- **æœŸæœ›ä½£é‡‘**: 188 Ã— 0.4 = 75.2ç¾å…ƒ
- **å®é™…è®°å½•ä½£é‡‘**: 28.2ç¾å…ƒ
- **å®é™…ä½£é‡‘ç‡**: 28.2 / 188 = 0.15 (15%)

## å¯èƒ½åŸå› åˆ†æ

### åŸå› 1ï¼šäºŒçº§é”€å”®è®¢å•çš„å·®é¢ä½£é‡‘ï¼ˆæœ€å¯èƒ½ï¼‰
å¦‚æœè¿™æ˜¯ä¸€ä¸ªäºŒçº§é”€å”®çš„è®¢å•ï¼Œè€Œè¯¥è®¢å•æ˜¯é€šè¿‡ä¸€çº§é”€å”®çš„é“¾æ¥è´­ä¹°çš„ï¼Œé‚£ä¹ˆï¼š
- äºŒçº§é”€å”®è·å¾—25%ä½£é‡‘
- ä¸€çº§é”€å”®è·å¾—å·®é¢ï¼š40% - 25% = **15%**
- 28.2ç¾å…ƒ = 188 Ã— 0.15 âœ…

### åŸå› 2ï¼šè®¢å•åˆ›å»ºæ—¶ä½£é‡‘ç‡è®¾ç½®é”™è¯¯
è®¢å•åˆ›å»ºæ—¶çš„ä½£é‡‘è®¡ç®—æµç¨‹ï¼š
```javascript
// api.js line 2096-2099
const salesInfo = await this.calculateCommission(processedOrderData.sales_code, processedOrderData.amount);
processedOrderData.commission_amount = salesInfo.commission;
processedOrderData.commission_rate = salesInfo.commission / processedOrderData.amount;
```

### åŸå› 3ï¼šé”€å”®ä½£é‡‘ç‡æœ¬èº«æ˜¯15%
å¦‚æœè¯¥é”€å”®åœ¨åˆ›å»ºæ—¶è®¾ç½®çš„ä½£é‡‘ç‡å°±æ˜¯15%ï¼Œè€Œä¸æ˜¯40%ã€‚

## éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥è®¢å•è¯¦æƒ…
åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
// æŸ¥çœ‹è®¢å•ID 27çš„è¯¦ç»†ä¿¡æ¯
const orders = await window.supabase
  .from('orders')
  .select('*')
  .eq('id', 27)
  .single();
console.log('è®¢å•è¯¦æƒ…:', orders.data);
console.log('é”€å”®ä»£ç :', orders.data.sales_code);
console.log('é”€å”®ç±»å‹:', orders.data.sales_type);
console.log('ä½£é‡‘ç‡:', orders.data.commission_rate);
console.log('ä½£é‡‘é‡‘é¢:', orders.data.commission_amount);
```

### 2. æ£€æŸ¥é”€å”®ä¿¡æ¯
```javascript
// æ ¹æ®é”€å”®ä»£ç æŸ¥è¯¢é”€å”®ä¿¡æ¯
const salesCode = 'XXX'; // ä»ä¸Šé¢è·å–çš„é”€å”®ä»£ç 
const primarySales = await window.supabase
  .from('primary_sales')
  .select('*')
  .eq('sales_code', salesCode)
  .single();
console.log('ä¸€çº§é”€å”®ä¿¡æ¯:', primarySales.data);

const secondarySales = await window.supabase
  .from('secondary_sales')
  .select('*')
  .eq('sales_code', salesCode)
  .single();
console.log('äºŒçº§é”€å”®ä¿¡æ¯:', secondarySales.data);
```

### 3. æ£€æŸ¥æ˜¯å¦æœ‰äºŒçº§é”€å”®å…³è”
```javascript
// æ£€æŸ¥è®¢å•çš„é”€å”®å…³è”
const order = await window.supabase
  .from('orders')
  .select(`
    *,
    primary_sales_id,
    secondary_sales_id
  `)
  .eq('id', 27)
  .single();
console.log('è®¢å•é”€å”®å…³è”:', {
  primary_sales_id: order.data.primary_sales_id,
  secondary_sales_id: order.data.secondary_sales_id
});
```

## è§£å†³æ–¹æ¡ˆ

### å¦‚æœæ˜¯å·®é¢ä½£é‡‘é—®é¢˜
è¿™æ˜¯æ­£å¸¸çš„ä¸šåŠ¡é€»è¾‘ï¼š
- äºŒçº§é”€å”®çš„è®¢å•ï¼Œä¸€çº§é”€å”®åªè·å¾—å·®é¢ä½£é‡‘
- è®¡ç®—æ˜¯æ­£ç¡®çš„ï¼š40% - 25% = 15%

### å¦‚æœæ˜¯ä½£é‡‘ç‡è®¾ç½®é”™è¯¯
éœ€è¦æ›´æ–°è®¢å•çš„ä½£é‡‘ä¿¡æ¯ï¼š
```sql
-- æ›´æ–°è®¢å•ä½£é‡‘
UPDATE orders 
SET 
  commission_rate = 0.4,
  commission_amount = 75.2
WHERE id = 27;
```

### å¦‚æœæ˜¯é”€å”®ä½£é‡‘ç‡é—®é¢˜
éœ€è¦æ£€æŸ¥å¹¶æ›´æ–°é”€å”®çš„ä½£é‡‘ç‡è®¾ç½®ï¼š
```sql
-- æ›´æ–°ä¸€çº§é”€å”®ä½£é‡‘ç‡
UPDATE primary_sales 
SET commission_rate = 0.4
WHERE sales_code = 'XXX';
```

## å»ºè®®

1. **å…ˆæ‰§è¡ŒéªŒè¯æ­¥éª¤**ï¼Œç¡®è®¤å…·ä½“åŸå› 
2. **æ£€æŸ¥è®¢å•çš„sales_typeå­—æ®µ**ï¼Œç¡®è®¤æ˜¯primaryè¿˜æ˜¯secondary
3. **æ£€æŸ¥è®¢å•çš„primary_sales_idå’Œsecondary_sales_id**ï¼Œç¡®è®¤é”€å”®å…³è”å…³ç³»
4. **æ ¹æ®ä¸šåŠ¡é€»è¾‘ç¡®è®¤**ï¼šå¦‚æœè¿™ç¡®å®æ˜¯äºŒçº§é”€å”®çš„è®¢å•ï¼Œ15%çš„å·®é¢ä½£é‡‘å¯èƒ½æ˜¯æ­£ç¡®çš„

