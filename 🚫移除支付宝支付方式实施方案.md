# 🚫 移除支付宝支付方式 - 完整实施方案

## 📋 影响范围分析

### 1. 前端页面需要修改
- **一级销售注册页面** (`client/src/pages/SalesPage.js`)
- **二级销售注册页面** (`client/src/pages/UnifiedSecondarySalesPage.js`) 
- **用户购买页面** (`client/src/pages/PurchasePage.js`)
- **管理员配置页面** (`client/src/components/admin/AdminPaymentConfig.js`)
- **管理员销售管理** (`client/src/components/admin/AdminSales.js`)
- **管理员订单管理** (`client/src/components/admin/AdminOrders.js`)
- **一级销售结算页面** (`client/src/pages/PrimarySalesSettlementPage.js`)

### 2. 数据库表需要修改
- **primary_sales表**: 移除支付宝相关字段
- **secondary_sales表**: 移除支付宝相关字段  
- **payment_config表**: 移除管理员支付宝配置字段
- **orders表**: 更新payment_method枚举值

### 3. 后端API需要修改
- **services/api.js**: 移除支付宝相关处理逻辑
- **services/supabase.js**: 更新数据库操作

## 🔧 具体修改内容

### 一、前端修改

#### 1. 销售注册页面（一级和二级）
```javascript
// 删除支付宝选项
<Select>
  {/* <Option value="alipay">支付宝</Option> */}
  <Option value="crypto">链上地址</Option>
</Select>

// 删除支付宝相关表单字段
{/* 删除以下代码块
{paymentMethod === 'alipay' && (
  <>
    <Form.Item name="payment_address" label="支付宝账号">
      ...
    </Form.Item>
    <Form.Item name="name" label="收款人姓氏">
      ...
    </Form.Item>
  </>
)}
*/}
```

#### 2. 用户购买页面
```javascript
// 移除支付宝默认选项
const [paymentMethod, setPaymentMethod] = useState('crypto'); // 改为默认crypto

// 删除支付宝相关显示逻辑
```

#### 3. 管理员配置页面
```javascript
// 删除整个支付宝配置卡片
{/* 删除以下代码块
<Card title="支付宝收款配置">
  ...
</Card>
*/}
```

### 二、数据库修改

#### 1. 更新表结构
```sql
-- 1. 更新orders表的payment_method枚举
ALTER TABLE orders 
MODIFY COLUMN payment_method ENUM('crypto') DEFAULT 'crypto';

-- 2. 移除primary_sales表的支付宝字段（如果存在）
-- 注意：需要先检查是否有数据依赖

-- 3. 移除secondary_sales表的支付宝字段（如果存在）
-- 注意：需要先检查是否有数据依赖

-- 4. 移除payment_config表的支付宝字段
ALTER TABLE payment_config
DROP COLUMN alipay_account,
DROP COLUMN alipay_name,
DROP COLUMN alipay_qr_code;
```

### 三、数据迁移策略

#### 1. 现有支付宝数据处理
```sql
-- 备份现有支付宝数据
CREATE TABLE backup_alipay_data AS
SELECT 
  id,
  sales_code,
  payment_method,
  payment_address,
  name
FROM primary_sales
WHERE payment_method = 'alipay';

-- 将现有支付宝用户迁移到crypto
UPDATE primary_sales
SET payment_method = 'crypto'
WHERE payment_method = 'alipay';

UPDATE secondary_sales  
SET payment_method = 'crypto'
WHERE payment_method = 'alipay';

UPDATE orders
SET payment_method = 'crypto'
WHERE payment_method = 'alipay';
```

## ⚠️ 注意事项

1. **数据备份**: 修改前必须备份所有相关数据
2. **分步执行**: 建议先在测试环境验证
3. **用户通知**: 如有正在使用支付宝的销售，需提前通知
4. **订单处理**: 确保所有待处理的支付宝订单已完成
5. **回滚方案**: 准备好回滚脚本以防出现问题

## 📝 实施步骤

1. **第一步**: 备份数据库
2. **第二步**: 执行数据迁移脚本
3. **第三步**: 更新前端代码
4. **第四步**: 更新后端API
5. **第五步**: 测试所有功能
6. **第六步**: 部署到生产环境

## 🎯 预期结果

- 所有销售注册只支持"链上地址"一种收款方式
- 管理员不再有支付宝配置选项
- 用户购买时只能选择链上地址支付
- 历史支付宝数据自动迁移到链上地址

## 📊 影响评估

- **影响用户数**: 需要统计当前使用支付宝的销售数量
- **影响订单数**: 需要统计待处理的支付宝订单
- **系统停机时间**: 预计30分钟完成所有修改和部署
