# ğŸ”§ è®¢å•ç»Ÿè®¡é‡å¤è®¡ç®—é—®é¢˜ä¿®å¤æ–¹æ¡ˆ

## é—®é¢˜åˆ†æ

åœ¨ `AdminAPI.getSales` æ–¹æ³•ä¸­ï¼Œä¸€çº§é”€å”®çš„è®¢å•ç»Ÿè®¡å­˜åœ¨é‡å¤è®¡ç®—é—®é¢˜ï¼š

### å½“å‰ä»£ç é€»è¾‘ï¼ˆç¬¬786-806è¡Œï¼‰ï¼š
```javascript
// 1. è·å–ä¸€çº§é”€å”®è‡ªå·±çš„è®¢å•
const saleOrders = orders.filter(order => 
  (order.sales_code === sale.sales_code || 
   order.primary_sales_id === sale.id) &&
  order.status !== 'rejected'
);

// 2. è·å–ç®¡ç†çš„äºŒçº§é”€å”®çš„è®¢å•
const secondaryOrders = [];
managedSecondaries.forEach(secondary => {
  const secOrders = orders.filter(order => 
    order.sales_code === secondary.sales_code &&
    order.status !== 'rejected'
  );
  secondaryOrders.push(...secOrders);
});

// 3. åˆå¹¶æ‰€æœ‰è®¢å•ï¼ˆå¯èƒ½é‡å¤ï¼‰
const allRelatedOrders = [...saleOrders, ...secondaryOrders];
```

## é—®é¢˜åœºæ™¯

å¦‚æœä¸€ä¸ªè®¢å•ï¼š
- `sales_code` = 'SEC123'ï¼ˆäºŒçº§é”€å”®ä»£ç ï¼‰
- `primary_sales_id` = 1ï¼ˆä¸€çº§é”€å”®IDï¼‰

è¿™ä¸ªè®¢å•ä¼šè¢«è®¡ç®—ä¸¤æ¬¡ï¼š
1. é€šè¿‡ `primary_sales_id === sale.id` æ¡ä»¶åŒ¹é…åˆ°
2. é€šè¿‡ `sales_code === secondary.sales_code` å†æ¬¡åŒ¹é…åˆ°

## ä¿®å¤æ–¹æ¡ˆ

ä½¿ç”¨ Map æŒ‰ `order_number` å»é‡ï¼š

```javascript
// ä½¿ç”¨ Map å»é‡ï¼Œä¿è¯æ¯ä¸ªè®¢å•åªè®¡ç®—ä¸€æ¬¡
const orderMap = new Map();

// æ·»åŠ ä¸€çº§é”€å”®è‡ªå·±çš„è®¢å•
saleOrders.forEach(order => {
  if (order.order_number) {
    orderMap.set(order.order_number, order);
  }
});

// æ·»åŠ äºŒçº§é”€å”®çš„è®¢å•ï¼ˆå¦‚æœè®¢å•å·å·²å­˜åœ¨åˆ™ä¸ä¼šé‡å¤æ·»åŠ ï¼‰
managedSecondaries.forEach(secondary => {
  const secOrders = orders.filter(order => 
    order.sales_code === secondary.sales_code &&
    order.status !== 'rejected'
  );
  secOrders.forEach(order => {
    if (order.order_number) {
      orderMap.set(order.order_number, order);
    }
  });
});

// è½¬æ¢ä¸ºæ•°ç»„
const allRelatedOrders = Array.from(orderMap.values());
```

## å½±å“èŒƒå›´

æ­¤ä¿®å¤å°†å½±å“ï¼š
1. æ€»è®¢å•æ•°
2. æœ‰æ•ˆè®¢å•æ•°
3. æ€»é‡‘é¢
4. å·²é…ç½®ç¡®è®¤è®¢å•é‡‘é¢
5. ä½£é‡‘è®¡ç®—

## é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼Œæ¯ä¸ªè®¢å•åªä¼šè¢«è®¡ç®—ä¸€æ¬¡ï¼Œç¡®ä¿æ•°æ®çš„å‡†ç¡®æ€§ã€‚
