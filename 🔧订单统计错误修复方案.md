# 🔧 订单统计重复计算问题修复方案

## 问题分析

在 `AdminAPI.getSales` 方法中，一级销售的订单统计存在重复计算问题：

### 当前代码逻辑（第786-806行）：
```javascript
// 1. 获取一级销售自己的订单
const saleOrders = orders.filter(order => 
  (order.sales_code === sale.sales_code || 
   order.primary_sales_id === sale.id) &&
  order.status !== 'rejected'
);

// 2. 获取管理的二级销售的订单
const secondaryOrders = [];
managedSecondaries.forEach(secondary => {
  const secOrders = orders.filter(order => 
    order.sales_code === secondary.sales_code &&
    order.status !== 'rejected'
  );
  secondaryOrders.push(...secOrders);
});

// 3. 合并所有订单（可能重复）
const allRelatedOrders = [...saleOrders, ...secondaryOrders];
```

## 问题场景

如果一个订单：
- `sales_code` = 'SEC123'（二级销售代码）
- `primary_sales_id` = 1（一级销售ID）

这个订单会被计算两次：
1. 通过 `primary_sales_id === sale.id` 条件匹配到
2. 通过 `sales_code === secondary.sales_code` 再次匹配到

## 修复方案

使用 Map 按 `order_number` 去重：

```javascript
// 使用 Map 去重，保证每个订单只计算一次
const orderMap = new Map();

// 添加一级销售自己的订单
saleOrders.forEach(order => {
  if (order.order_number) {
    orderMap.set(order.order_number, order);
  }
});

// 添加二级销售的订单（如果订单号已存在则不会重复添加）
managedSecondaries.forEach(secondary => {
  const secOrders = orders.filter(order => 
    order.sales_code === secondary.sales_code &&
    order.status !== 'rejected'
  );
  secOrders.forEach(order => {
    if (order.order_number) {
      orderMap.set(order.order_number, order);
    }
  });
});

// 转换为数组
const allRelatedOrders = Array.from(orderMap.values());
```

## 影响范围

此修复将影响：
1. 总订单数
2. 有效订单数
3. 总金额
4. 已配置确认订单金额
5. 佣金计算

## 预期效果

修复后，每个订单只会被计算一次，确保数据的准确性。
