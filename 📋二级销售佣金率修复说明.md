# 📋 二级销售佣金率修复说明

## 🔍 问题描述

waterli_1313 作为 WML792355703 的二级销售：
- 手动设置佣金率为 25%
- 但系统显示为 30%
- 要求二级销售全部默认佣金率为 25%

## 🎯 问题原因

存在多处不一致：

| 位置 | 原值 | 应该值 |
|-----|------|--------|
| 数据库 secondary_sales 表默认值 | 30% | 25% |
| api.js 第883行（显示时的默认值） | 25% | 25% ✅ |
| api.js registerSecondary（创建时） | 未设置 | 25% |
| PrimarySalesSettlementPage 第550行 | 30% | 25% |

## ✅ 修复内容

### 1. 数据库修改（需在 Supabase 执行）
执行文件：`🔧修改二级销售默认佣金率为25%.sql`
- 修改表默认值为 25%
- 更新现有 30% 的记录为 25%

### 2. 前端代码修改

#### `client/src/services/api.js`
- 第1728行：添加 `salesData.commission_rate = salesData.commission_rate || 25;`
- 确保新创建的二级销售默认佣金率为 25%

#### `client/src/pages/PrimarySalesSettlementPage.js`
- 第551行：将默认值从 30 改为 25
- 确保编辑时显示正确的默认值

## 📊 数据流程

```
创建二级销售
    ↓
api.js: commission_rate = 25
    ↓
数据库: DEFAULT 25%
    ↓
显示时: commission_rate || 25
```

## 🔧 验证步骤

1. **检查 waterli_1313 的佣金率**
   ```sql
   SELECT wechat_name, commission_rate 
   FROM secondary_sales 
   WHERE wechat_name = 'waterli_1313';
   ```

2. **创建新的二级销售**
   - 注册新的二级销售
   - 检查佣金率是否为 25%

3. **修改现有二级销售**
   - 在一级销售结算页面
   - 点击"设置佣金"
   - 验证默认值是否为 25%

## ⚠️ 注意事项

- 需要先在 Supabase 执行 SQL 脚本
- 已经手动设置为其他值的二级销售不会被影响
- 只有值为 30% 或 NULL 的会被更新为 25%

## 📝 影响范围

- 所有新创建的二级销售
- 所有使用默认佣金率的二级销售
- 不影响已手动设置特殊佣金率的二级销售

---

**修复时间**：2025-01-07
**版本**：v2.7.1
