# 📝 删除name字段后的前端代码修改清单

## 需要修改的文件和位置

### 1. **client/src/services/api.js**

#### 修改位置1：第461行
```javascript
// 原代码（错误的备选逻辑）
const wechatName = sale.wechat_name || sale.name || sale.phone || `一级销售-${sale.sales_code}`;

// 修改为（删除name备选）
const wechatName = sale.wechat_name || sale.phone || `一级销售-${sale.sales_code}`;
```

#### 修改位置2：第327行和第342行
```javascript
// 原代码（迁移历史数据时的备选）
const wechatName = sale.name || sale.phone || `销售_${sale.sales_code}`;

// 修改为
const wechatName = sale.phone || `销售_${sale.sales_code}`;
```

#### 修改位置3：第569行
```javascript
// 原代码
const wechatName = sale.wechat_name || sale.name || sale.phone || `二级销售-${sale.sales_code}`;

// 修改为
const wechatName = sale.wechat_name || sale.phone || `二级销售-${sale.sales_code}`;
```

### 2. **client/src/services/supabase.js**

#### 修改位置1：第522-523行，第530行，第536行
```javascript
// 原代码（查询时包含name字段）
.select('id, sales_code, name, wechat_name, phone')

// 修改为（移除name字段）
.select('id, sales_code, wechat_name, phone')
```

#### 修改位置2：第615行
```javascript
// 原代码
order.sales_name = salesInfo.name || '-';

// 可以删除这一行，或改为
order.sales_name = '-';  // 保留字段但始终为空
```

#### 修改位置3：第618行
```javascript
// 原代码
console.log(`订单 ${order.order_number} 关联${salesType}销售:`, salesInfo.name);

// 修改为
console.log(`订单 ${order.order_number} 关联${salesType}销售:`, salesInfo.wechat_name);
```

### 3. **其他诊断和测试文件**

这些文件中的 `sale.name` 引用可以保留，因为它们只是诊断工具：
- 🔍诊断八八测试员确认订单问题.js
- 🔍诊断销售脏数据问题.js
- 🔧重新计算销售订单数据.js

## 🎯 关键改动总结

1. **移除所有把 `name` 作为微信号备选的逻辑**
2. **查询时不再包含 `name` 字段**
3. **日志输出改为使用 `wechat_name`**

## ⚠️ 注意事项

- **不影响核心功能**：因为系统已经不使用支付宝支付
- **`wechat_name` 是必填字段**：新创建的销售记录都有 wechat_name
- **历史数据处理**：如果有历史数据 wechat_name 为空，会显示为 "销售_XXX" 或使用电话号码
