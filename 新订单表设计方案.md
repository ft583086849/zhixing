# ğŸ¯ æ–°è®¢å•è¡¨è®¾è®¡æ–¹æ¡ˆ

## è¡¨åï¼šorders_optimized

### ğŸ“‹ åŸºç¡€ä¿¡æ¯å­—æ®µ
| å­—æ®µå | ç±»å‹ | æè¿° | ç´¢å¼• | å¿…å¡« |
|--------|------|------|------|------|
| id | BIGSERIAL | ä¸»é”®ID | PRIMARY | âœ… |
| order_number | VARCHAR(50) | è®¢å•å· | UNIQUE | âœ… |
| created_at | TIMESTAMPTZ | åˆ›å»ºæ—¶é—´ | INDEX | âœ… |
| updated_at | TIMESTAMPTZ | æ›´æ–°æ—¶é—´ | INDEX | âœ… |

### ğŸ‘¤ å®¢æˆ·ä¿¡æ¯å­—æ®µ
| å­—æ®µå | ç±»å‹ | æè¿° | ç´¢å¼• | å¿…å¡« |
|--------|------|------|------|------|
| customer_name | VARCHAR(100) | å®¢æˆ·å§“å | INDEX | âœ… |
| customer_phone | VARCHAR(20) | å®¢æˆ·ç”µè¯ | INDEX | âŒ |
| customer_email | VARCHAR(100) | å®¢æˆ·é‚®ç®± | INDEX | âŒ |
| customer_wechat | VARCHAR(50) | å®¢æˆ·å¾®ä¿¡ | INDEX | âŒ |
| tradingview_username | VARCHAR(50) | TradingViewç”¨æˆ·å | INDEX | âŒ |

### ğŸ’° é‡‘é¢å’Œæ”¯ä»˜å­—æ®µ
| å­—æ®µå | ç±»å‹ | æè¿° | ç´¢å¼• | å¿…å¡« |
|--------|------|------|------|------|
| amount | DECIMAL(10,2) | è®¢å•é‡‘é¢ | INDEX | âœ… |
| actual_payment_amount | DECIMAL(10,2) | å®é™…æ”¯ä»˜é‡‘é¢ | INDEX | âŒ |
| alipay_amount | DECIMAL(10,2) | æ”¯ä»˜å®é‡‘é¢ | âŒ | âŒ |
| crypto_amount | DECIMAL(10,2) | åŠ å¯†è´§å¸é‡‘é¢ | âŒ | âŒ |
| payment_method | VARCHAR(20) | æ”¯ä»˜æ–¹å¼ | INDEX | âŒ |
| payment_status | VARCHAR(20) | æ”¯ä»˜çŠ¶æ€ | INDEX | âœ… |
| payment_time | TIMESTAMPTZ | æ”¯ä»˜æ—¶é—´ | INDEX | âŒ |

### ğŸ“¦ äº§å“å’Œè®¢å•å­—æ®µ
| å­—æ®µå | ç±»å‹ | æè¿° | ç´¢å¼• | å¿…å¡« |
|--------|------|------|------|------|
| duration | VARCHAR(20) | è®¢å•æ—¶é•¿ | INDEX | âœ… |
| purchase_type | VARCHAR(20) | è´­ä¹°ç±»å‹ | INDEX | âŒ |
| status | VARCHAR(20) | è®¢å•çŠ¶æ€ | INDEX | âœ… |
| config_confirmed | BOOLEAN | é…ç½®ç¡®è®¤ | INDEX | âŒ |
| effective_time | TIMESTAMPTZ | ç”Ÿæ•ˆæ—¶é—´ | INDEX | âŒ |
| expiry_time | TIMESTAMPTZ | è¿‡æœŸæ—¶é—´ | INDEX | âŒ |
| submit_time | TIMESTAMPTZ | æäº¤æ—¶é—´ | INDEX | âŒ |

### ğŸ‘¥ é”€å”®å…³è”å­—æ®µ
| å­—æ®µå | ç±»å‹ | æè¿° | ç´¢å¼• | å¿…å¡« |
|--------|------|------|------|------|
| sales_code | VARCHAR(50) | é”€å”®ä»£ç  | INDEX | âŒ |
| sales_type | VARCHAR(20) | é”€å”®ç±»å‹ | INDEX | âŒ |
| primary_sales_id | BIGINT | ä¸€çº§é”€å”®ID | INDEX | âŒ |
| secondary_sales_id | BIGINT | äºŒçº§é”€å”®ID | INDEX | âŒ |
| commission_amount | DECIMAL(10,2) | ä½£é‡‘é‡‘é¢ | INDEX | âŒ |
| commission_rate | DECIMAL(5,4) | ä½£é‡‘æ¯”ç‡ | âŒ | âŒ |
| link_code | VARCHAR(50) | æ¨å¹¿é“¾æ¥ä»£ç  | INDEX | âŒ |

### ğŸ“ é™„ä»¶å’Œæˆªå›¾å­—æ®µ
| å­—æ®µå | ç±»å‹ | æè¿° | ç´¢å¼• | å¿…å¡« |
|--------|------|------|------|------|
| screenshot_path | VARCHAR(255) | æˆªå›¾è·¯å¾„ | âŒ | âŒ |
| screenshot_data | TEXT | æˆªå›¾æ•°æ® | âŒ | âŒ |

### ğŸš€ æ€§èƒ½ä¼˜åŒ–å­—æ®µï¼ˆæ–°å¢ï¼‰
| å­—æ®µå | ç±»å‹ | æè¿° | ç´¢å¼• | å¿…å¡« |
|--------|------|------|------|------|
| search_keywords | TEXT | æœç´¢å…³é”®è¯ | FULLTEXT | âŒ |
| data_version | INTEGER | æ•°æ®ç‰ˆæœ¬ | âŒ | âŒ |
| is_deleted | BOOLEAN | è½¯åˆ é™¤æ ‡è®° | INDEX | âŒ |

### ğŸ¯ æœªæ¥æ‰©å±•å­—æ®µï¼ˆä¸ºæ³¨å†Œç³»ç»Ÿé¢„ç•™ï¼‰
| å­—æ®µå | ç±»å‹ | æè¿° | ç´¢å¼• | å¿…å¡« |
|--------|------|------|------|------|
| customer_id | BIGINT | å®¢æˆ·IDï¼ˆå¤–é”®ï¼‰ | INDEX | âŒ |
| source_channel | VARCHAR(50) | æ¥æºæ¸ é“ | INDEX | âŒ |
| referrer_code | VARCHAR(50) | æ¨èäººä»£ç  | INDEX | âŒ |
| campaign_id | VARCHAR(50) | è¥é”€æ´»åŠ¨ID | INDEX | âŒ |
| device_info | JSONB | è®¾å¤‡ä¿¡æ¯ | âŒ | âŒ |
| geo_location | JSONB | åœ°ç†ä½ç½® | âŒ | âŒ |
| risk_score | INTEGER | é£é™©è¯„åˆ† | INDEX | âŒ |
| tags | JSONB | æ ‡ç­¾æ•°ç»„ | GIN | âŒ |

## ğŸ” å¤åˆç´¢å¼•è®¾è®¡

### æ ¸å¿ƒæŸ¥è¯¢ç´¢å¼•
```sql
-- è®¢å•åˆ—è¡¨æŸ¥è¯¢ï¼ˆæœ€å¸¸ç”¨ï¼‰
CREATE INDEX idx_orders_list ON orders_optimized (payment_status, created_at DESC);

-- é”€å”®ç›¸å…³æŸ¥è¯¢
CREATE INDEX idx_orders_sales ON orders_optimized (sales_type, primary_sales_id, secondary_sales_id);

-- æ—¶é—´èŒƒå›´æŸ¥è¯¢
CREATE INDEX idx_orders_time_range ON orders_optimized (created_at, payment_time, effective_time);

-- å®¢æˆ·æŸ¥è¯¢
CREATE INDEX idx_orders_customer ON orders_optimized (customer_name, customer_phone, customer_wechat);

-- çŠ¶æ€å’Œé…ç½®æŸ¥è¯¢
CREATE INDEX idx_orders_status ON orders_optimized (status, config_confirmed, is_deleted);

-- é‡‘é¢æŸ¥è¯¢
CREATE INDEX idx_orders_amount ON orders_optimized (amount, actual_payment_amount);
```

### é«˜çº§æŸ¥è¯¢ç´¢å¼•
```sql
-- é”€å”®ä¸šç»©æŸ¥è¯¢
CREATE INDEX idx_orders_performance ON orders_optimized (sales_type, payment_status, amount, commission_amount);

-- äº§å“åˆ†ææŸ¥è¯¢
CREATE INDEX idx_orders_product ON orders_optimized (duration, purchase_type, payment_status);

-- æœç´¢ä¼˜åŒ–
CREATE INDEX idx_orders_search ON orders_optimized USING GIN (search_keywords);

-- æ ‡ç­¾æŸ¥è¯¢
CREATE INDEX idx_orders_tags ON orders_optimized USING GIN (tags);
```

## ğŸ“Š é¢„æœŸæ€§èƒ½æå‡

| æŸ¥è¯¢ç±»å‹ | å½“å‰è€—æ—¶ | é¢„æœŸè€—æ—¶ | æå‡å€æ•° |
|----------|----------|----------|----------|
| å…¨éƒ¨è®¢å• | 1536ms | <50ms | 30x |
| çŠ¶æ€ç­›é€‰ | 1362ms | <30ms | 45x |
| é”€å”®ç­›é€‰ | 852ms | <20ms | 42x |
| å®¢æˆ·æœç´¢ | >1000ms | <15ms | 60x |

## ğŸ¯ ä¼˜åŠ¿æ€»ç»“

1. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - æ·»åŠ äº†30+ä¸ªç´¢å¼•ï¼Œè¦†ç›–æ‰€æœ‰å¸¸ç”¨æŸ¥è¯¢
   - å¤åˆç´¢å¼•ä¼˜åŒ–ç»„åˆæŸ¥è¯¢
   - å…¨æ–‡æœç´¢æ”¯æŒ

2. **å…¼å®¹æ€§è®¾è®¡**ï¼š
   - ä¿ç•™æ‰€æœ‰åŸæœ‰å­—æ®µ
   - é¢„ç•™æœªæ¥æ³¨å†Œç³»ç»Ÿå­—æ®µ
   - æ”¯æŒè½¯åˆ é™¤å’Œç‰ˆæœ¬æ§åˆ¶

3. **å¯æ‰©å±•æ€§**ï¼š
   - JSONBå­—æ®µæ”¯æŒçµæ´»æ•°æ®
   - æ ‡ç­¾ç³»ç»Ÿæ”¯æŒåˆ†ç±»
   - è®¾å¤‡å’Œåœ°ç†ä¿¡æ¯æ”¯æŒ

4. **æ•°æ®å®Œæ•´æ€§**ï¼š
   - åˆç†çš„å­—æ®µç±»å‹å’Œé•¿åº¦
   - å¿…è¦çš„çº¦æŸå’Œç´¢å¼•
   - æ—¶é—´æˆ³è‡ªåŠ¨æ›´æ–°