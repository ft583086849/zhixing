# 📊 知行财库数据库实际表结构文档

> 生成时间：2025-01-13
> 数据库类型：Supabase (PostgreSQL)
> 数据库URL：https://itvmeamoqthfqtkpubdv.supabase.co

---

## 📋 表结构详情

### 1. orders表 - 订单表
**记录数**: 102条

| 字段名 | 数据类型 | 说明 | 示例值 |
|--------|----------|------|--------|
| id | integer | 主键，自增ID | 48 |
| order_number | string | 订单号 | "ORD1754889551236" |
| customer_name | string | 客户姓名 | "qq4073969" |
| customer_phone | null/string | 客户电话 | NULL |
| customer_email | null/string | 客户邮箱 | NULL |
| customer_wechat | string | 客户微信 | "qq4073969" |
| tradingview_username | string | TradingView用户名 | "obsess" |
| amount | decimal | 订单金额 | 0 |
| actual_payment_amount | decimal | 实际支付金额 | 0 |
| alipay_amount | null/decimal | 支付宝金额 | NULL |
| crypto_amount | null/decimal | 加密货币金额 | NULL |
| status | string | 订单状态 | "confirmed_config" |
| payment_status | string | 支付状态 | "pending" |
| payment_method | string | 支付方式 | "crypto" |
| payment_time | timestamp | 支付时间 | "2025-08-11T13:19:11" |
| duration | string | 订阅时长 | "7days" |
| purchase_type | string | 购买类型 | "immediate" |
| effective_time | null/timestamp | 生效时间 | NULL |
| expiry_time | null/timestamp | 到期时间 | NULL |
| sales_code | null/string | 销售代码 | NULL |
| link_code | null/string | 链接代码 | NULL |
| sales_type | null/string | 销售类型 | NULL |
| primary_sales_id | null/integer | 一级销售ID | NULL |
| secondary_sales_id | null/integer | 二级销售ID | NULL |
| commission_rate | decimal | 佣金率 | 0 |
| commission_amount | decimal | 佣金金额 | 0 |
| screenshot_path | null/string | 截图路径 | NULL |
| screenshot_data | null/text | 截图数据(base64) | NULL |
| config_confirmed | boolean | 配置确认 | true |
| created_at | timestamp | 创建时间 | "2025-08-11T05:19:11.236+00:00" |
| updated_at | timestamp | 更新时间 | "2025-08-11T09:17:14.755+00:00" |
| submit_time | timestamp | 提交时间 | "2025-08-11T05:19:11.632073" |

---

### 2. secondary_sales表 - 销售信息表（原sales表）
**记录数**: 未知（实际存在数据）

| 字段名 | 数据类型 | 说明 | 示例值 |
|--------|----------|------|--------|
| id | integer | 主键，自增ID | 3 |
| sales_code | string | 销售代码 | "SEC17547252976848697" |
| wechat_name | string | 微信名称 | "fl261247" |
| name | null/string | 姓名（已废弃） | NULL |
| phone | null/string | 电话（已废弃） | NULL |
| email | null/string | 邮箱（已废弃） | NULL |
| payment_method | string | 支付方式 | "crypto" |
| payment_address | string | 收款地址 | "TH3NngKNzAcia6MdBVjyLFkg75FKrdyYvk" |
| chain_name | string | 链名 | "TRC20" |
| alipay_account | null/string | 支付宝账号（已废弃） | NULL |
| alipay_surname | null/string | 支付宝姓氏（已废弃） | NULL |
| line_address_code | null/string | 线上地址码（已废弃） | NULL |
| line_name | null/string | 线名（已废弃） | NULL |
| sales_type | string | 销售类型 | "secondary" |
| primary_sales_id | integer | 上级销售ID | 4 |
| primary_registration_code | null/string | 注册码 | NULL |
| commission_rate | decimal | 佣金率(0.25=25%) | 0.25 |
| paid_commission | decimal | 已付佣金 | 397 |
| last_commission_paid_at | timestamp | 最后付佣时间 | "2025-08-10T07:56:10.087" |
| status | string | 状态 | "active" |
| removed_by | null/integer | 移除者ID | NULL |
| removed_at | null/timestamp | 移除时间 | NULL |
| created_at | timestamp | 创建时间 | "2025-08-09T07:41:37.684+00:00" |
| updated_at | timestamp | 更新时间 | "2025-08-09T08:17:21.747+00:00" |

---

### 3. admins表 - 管理员表
**记录数**: 2条

| 字段名 | 数据类型 | 说明 | 示例值 |
|--------|----------|------|--------|
| id | integer | 主键，自增ID | 10 |
| username | string | 用户名 | "知行" |
| password_hash | string | 密码哈希 | "Zhixing Universal Trading Signal" |
| role | string | 角色 | "admin" |
| created_at | timestamp | 创建时间 | "2025-08-06T13:50:16.88681+00:00" |
| updated_at | timestamp | 更新时间 | "2025-08-06T13:50:16.88681+00:00" |

---

### 4. payment_config表 - 支付配置表
**记录数**: 4条

| 字段名 | 数据类型 | 说明 | 示例值 |
|--------|----------|------|--------|
| id | integer | 主键，自增ID | 1 |
| alipay_account | string | 支付宝账号（已废弃） | "752304285@qq.com" |
| alipay_name | string | 支付宝姓名（已废弃） | "梁" |
| alipay_qr_code | text | 支付宝二维码(base64) | "data:image/jpeg;base64,..." |
| crypto_chain_name | string | 加密货币链名 | "TRC10/TRC20" |
| crypto_address | string | 加密货币地址 | "TDnNfU9GYcDbzFqf8LUNzBuTsaDbCh5LTo" |
| crypto_qr_code | text | 加密货币二维码(base64) | "data:image/jpeg;base64,..." |
| crypto2_chain_name | string | 第二链名 | "BSC" |
| crypto2_address | string | 第二地址 | "0xAE25E29d3baCD91B0fFd0807859531419a85375a" |
| crypto2_qr_code | null/text | 第二二维码(base64) | NULL |
| is_active | boolean | 是否激活 | false |
| created_at | timestamp | 创建时间 | "2025-08-07T04:04:36.572405+00:00" |
| updated_at | timestamp | 更新时间 | "2025-08-08T12:19:59.436+00:00" |

---

### 5. profit_distribution表 - 收益分配表
**记录数**: 2条

| 字段名 | 数据类型 | 说明 | 示例值 |
|--------|----------|------|--------|
| id | uuid | 主键，UUID | "9249ea4f-9862-4977-b71a-e49ec638ee2a" |
| public_ratio | decimal | 公户占比 | 40 |
| marketing_ratio | decimal | 营销费用占比 | 10 |
| dividend_ratio | decimal | 分红占比 | 15 |
| development_ratio | decimal | 开发费用占比 | 15 |
| zhixing_ratio | decimal | 知行占比 | 35 |
| zijun_ratio | decimal | 子俊占比 | 25 |
| ratio | decimal | 总比例 | 100 |
| allocated_amount | decimal | 已分配金额 | 0 |
| category | string | 类别 | "default" |
| is_active | boolean | 是否激活 | true |
| created_by | string | 创建者 | "system" |
| created_at | timestamp | 创建时间 | "2025-08-08T17:39:44.729243+00:00" |
| updated_at | timestamp | 更新时间 | "2025-08-10T07:19:15.034788+00:00" |

---

## 📝 重要说明

### 1. 表的变化
- **sales表已不存在**：系统改为使用`secondary_sales`表存储所有销售信息
- **lifetime_limit表已不存在**：永久授权功能已停用，改为年费制

### 2. 数据类型说明
- **timestamp**: PostgreSQL的时间戳，格式为ISO 8601（如：2025-08-11T05:19:11.236+00:00）
- **decimal**: 十进制数，用于金额和百分比
- **integer**: 整数，用于ID和计数
- **string**: 字符串，长度根据实际需求
- **text**: 长文本，用于base64图片数据
- **uuid**: 通用唯一识别码，用于profit_distribution表的主键
- **boolean**: 布尔值，true/false

### 3. 关键字段说明

#### 佣金率字段
- 存储格式：小数（0.25表示25%）
- 在`secondary_sales`表中：`commission_rate`
- 在`orders`表中：`commission_rate`

#### 支付方式
- 目前只支持：`crypto`（加密货币）
- 历史数据可能包含：`alipay`（已废弃）

#### 订单状态（status字段）
- `pending_payment` - 待付款
- `confirmed_payment` - 已付款
- `pending_config` - 待配置
- `confirmed_config` - 已配置
- `active` - 已激活
- `rejected` - 已拒绝

#### 销售类型（sales_type字段）
- `primary` - 一级销售
- `secondary` - 二级销售
- `independent` - 独立销售

### 4. 表关系
- `orders.primary_sales_id` → `secondary_sales.id`（一级销售）
- `orders.secondary_sales_id` → `secondary_sales.id`（二级销售）
- `secondary_sales.primary_sales_id` → `secondary_sales.id`（上级关系）

### 5. 数据统计（截至查询时）
- 订单总数：102条
- 管理员数：2个
- 支付配置：4条
- 收益分配方案：2个

---

## 🔍 数据库访问信息

- **数据库类型**: PostgreSQL (Supabase托管)
- **连接方式**: Supabase Client SDK
- **认证方式**: JWT Token
- **API端点**: https://itvmeamoqthfqtkpubdv.supabase.co
- **实时订阅**: 支持（通过Supabase Realtime）

---

*文档生成时间：2025-01-13*
*数据来源：生产环境实时查询*