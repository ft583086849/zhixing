# ğŸ“Š äºŒçº§é”€å”®æ³¨å†Œé“¾è·¯å½±å“åˆ†æ

## ä¸€ã€ä¿®æ”¹å†…å®¹å›é¡¾

### ä¿®æ”¹ä½ç½®
- æ–‡ä»¶ï¼š`client/src/services/api.js`
- æ–¹æ³•ï¼š`registerSecondary`
- è¡Œå·ï¼š1422-1425

### ä¿®æ”¹é€»è¾‘
```javascript
// åˆ›å»ºæ•°æ®å‰¯æœ¬ï¼Œä»…åˆ é™¤å‰¯æœ¬ä¸­çš„ registration_code
const dataForDB = {...salesData};
delete dataForDB.registration_code;
const newSale = await SupabaseService.createSecondarySales(dataForDB);
```

## äºŒã€å½±å“èŒƒå›´åˆ†æ

### âœ… ä¸å—å½±å“çš„åŠŸèƒ½

#### 1. ç‹¬ç«‹åˆ†é”€æ³¨å†Œ
- **è·¯å¾„**ï¼š`/secondary-sales`ï¼ˆæ— å‚æ•°ï¼‰
- **æ•°æ®æµ**ï¼š
  ```
  å‰ç«¯ â†’ ä¸ä¼  registration_code
  API â†’ ä¸è§¦å‘ registration_code ç›¸å…³é€»è¾‘
  æ•°æ®åº“ â†’ æ­£å¸¸æ’å…¥ï¼ˆæ—  registration_code å­—æ®µï¼‰
  ```
- **ç»“è®º**ï¼šâœ… å®Œå…¨ä¸å—å½±å“

#### 2. å‚æ•°éªŒè¯é€»è¾‘
- `registration_code` éªŒè¯é€»è¾‘ä¿æŒä¸å˜
- `primary_sales_id` æŸ¥è¯¢é€»è¾‘ä¿æŒä¸å˜
- ä»…åœ¨æœ€åæ•°æ®åº“æ“ä½œæ—¶åˆ é™¤å­—æ®µ

#### 3. ä¸€çº§é”€å”®åŠŸèƒ½
- ä¸€çº§é”€å”®æ³¨å†Œä½¿ç”¨ `registerPrimary` æ–¹æ³•
- å®Œå…¨ç‹¬ç«‹çš„ä»£ç è·¯å¾„
- **ç»“è®º**ï¼šâœ… ä¸å—å½±å“

#### 4. ç”¨æˆ·è´­ä¹°æµç¨‹
- é€šè¿‡ `sales_code` æŸ¥æ‰¾é”€å”®
- ä¸æ¶‰åŠ `registration_code`
- **ç»“è®º**ï¼šâœ… ä¸å—å½±å“

### âš ï¸ éœ€è¦éªŒè¯çš„åŠŸèƒ½

#### 1. å…³è”äºŒçº§åˆ†é”€æ³¨å†Œ
- **è·¯å¾„**ï¼š`/secondary-sales?registration_code=XXX`
- **æ•°æ®æµ**ï¼š
  ```
  URLå‚æ•° â†’ registration_code
  å‰ç«¯éªŒè¯ â†’ validateSecondaryRegistrationCode
  æäº¤æ•°æ® â†’ åŒ…å« registration_code å’Œ primary_sales_id
  APIå¤„ç† â†’ éªŒè¯å¹¶è·å– primary_sales_id
  æ•°æ®åº“ â†’ æ’å…¥æ—¶åˆ é™¤ registration_code
  ```
- **å…³é”®ç‚¹**ï¼š
  - âœ… éªŒè¯é€»è¾‘æ­£å¸¸æ‰§è¡Œ
  - âœ… primary_sales_id æ­£ç¡®è®¾ç½®
  - âœ… æ•°æ®åº“ä¸ä¼šæŠ¥é”™

#### 2. è¾¹ç•Œæƒ…å†µ
- ç©º `registration_code`ï¼šå½“ä½œç‹¬ç«‹åˆ†é”€å¤„ç†
- æ— æ•ˆ `registration_code`ï¼šéªŒè¯å¤±è´¥ï¼Œè¿”å›é”™è¯¯
- å·²ä½¿ç”¨çš„ `registration_code`ï¼šå¯é‡å¤ä½¿ç”¨ï¼ˆæ— å”¯ä¸€æ€§çº¦æŸï¼‰

## ä¸‰ã€æµ‹è¯•åœºæ™¯æ¸…å•

| åœºæ™¯ | è¾“å…¥å‚æ•° | é¢„æœŸç»“æœ | é£é™©ç­‰çº§ |
|------|---------|---------|----------|
| ç‹¬ç«‹åˆ†é”€æ³¨å†Œ | æ—  registration_code | åˆ›å»ºç‹¬ç«‹äºŒçº§é”€å”® | ä½ |
| å…³è”åˆ†é”€ï¼ˆå®Œæ•´å‚æ•°ï¼‰ | registration_code + primary_sales_id | åˆ›å»ºå…³è”äºŒçº§é”€å”® | ä½ |
| å…³è”åˆ†é”€ï¼ˆä»…æ³¨å†Œç ï¼‰ | ä»… registration_code | æŸ¥è¯¢å¹¶å…³è” | ä¸­ |
| ç©ºæ³¨å†Œç  | registration_code = "" | å½“ä½œç‹¬ç«‹åˆ†é”€ | ä½ |
| æ— æ•ˆæ³¨å†Œç  | registration_code = "INVALID" | éªŒè¯å¤±è´¥ | ä½ |

## å››ã€è°ƒç”¨é“¾åˆ†æ

```
UnifiedSecondarySalesPage.js
    â†“
    handleSubmit()
    â†“
    salesAPI.registerSecondary()  â† ä¿®æ”¹ä½ç½®
    â†“
    SupabaseService.createSecondarySales()
    â†“
    Supabase DB
```

### è°ƒç”¨ä½ç½®
1. `UnifiedSecondarySalesPage.js` - ç¬¬100è¡Œå’Œ109è¡Œ
2. æ— å…¶ä»–ç›´æ¥è°ƒç”¨

## äº”ã€é£é™©è¯„ä¼°

### ä½é£é™© âœ…
1. ä¿®æ”¹ä»…å½±å“æ•°æ®åº“æ’å…¥å‰çš„æ•°æ®å¤„ç†
2. ä¸æ”¹å˜ä¸šåŠ¡é€»è¾‘æµç¨‹
3. ä¿ç•™æ‰€æœ‰éªŒè¯é€»è¾‘
4. ä½¿ç”¨æ•°æ®å‰¯æœ¬ï¼Œä¸å½±å“åŸå§‹æ•°æ®

### æ½œåœ¨é£é™© âš ï¸
1. å¦‚æœæœªæ¥éœ€è¦ `registration_code` å­—æ®µç”¨äºå®¡è®¡
   - ç¼“è§£ï¼šå¯ä»¥æ·»åŠ æ—¥å¿—è®°å½•
2. å¦‚æœæ•°æ®åº“åç»­æ·»åŠ äº† `registration_code` å­—æ®µ
   - ç¼“è§£ï¼šåˆ é™¤è¿™è¡Œä»£ç å³å¯

## å…­ã€éªŒè¯æ­¥éª¤

### 1. ä»£ç éªŒè¯
```javascript
// æ£€æŸ¥ä¿®å¤æ˜¯å¦ç”Ÿæ•ˆ
quickValidate()
```

### 2. åŠŸèƒ½éªŒè¯
```javascript
// è¿è¡Œæ‰€æœ‰æµ‹è¯•åœºæ™¯
runAllTests()
```

### 3. çº¿ä¸ŠéªŒè¯
1. è®¿é—®ç‹¬ç«‹åˆ†é”€æ³¨å†Œé¡µé¢
2. è®¿é—®å…³è”åˆ†é”€æ³¨å†Œé¡µé¢
3. æ£€æŸ¥æ•°æ®åº“è®°å½•

## ä¸ƒã€å›æ»šæ–¹æ¡ˆ

å¦‚éœ€å›æ»šï¼Œåªéœ€åˆ é™¤ä»¥ä¸‹ä»£ç ï¼š
```javascript
// åˆ é™¤è¿™ä¸‰è¡Œ
const dataForDB = {...salesData};
delete dataForDB.registration_code;
// æ”¹å›
const newSale = await SupabaseService.createSecondarySales(salesData);
```

## å…«ã€ç»“è®º

- **å½±å“èŒƒå›´**ï¼šæå°ï¼Œä»…å½±å“äºŒçº§é”€å”®æ³¨å†Œçš„æ•°æ®åº“æ’å…¥
- **é£é™©ç­‰çº§**ï¼šä½
- **å…¼å®¹æ€§**ï¼šå‘åå…¼å®¹ï¼Œä¸ç ´åç°æœ‰åŠŸèƒ½
- **å»ºè®®**ï¼šå®‰å…¨å¯ç”¨ï¼Œå»ºè®®ä¿æŒæ­¤ä¿®å¤
