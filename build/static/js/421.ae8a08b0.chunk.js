"use strict";(self.webpackChunkzhixing=self.webpackChunkzhixing||[]).push([[421],{8421:(e,t,n)=>{n.r(t),n.d(t,{default:()=>z});var i=n(5043),a=n(5206),r=n(5397),l=n(1645),o=n(7734),s=n(3427),d=n(5444),c=n(1118),m=n(2019),x=n(6909),h=n(7419),u=n(6553),y=n(6051),p=n(6612),A=n(1381),g=n(6399),j=n(1023),f=n(6401),w=n(9470),v=n(2058),_=n(3761),k=n(8818),S=n(3722),I=n(9456),C=n(8608),F=n(579);const{Option:Y}=u.A,{Title:b}=j.A,z=()=>{const e=(0,I.wA)(),{loading:t}=(0,I.d4)(e=>e.sales),[n,u]=(0,i.useState)(null),[j,Y]=(0,i.useState)(null),[z,$]=(0,i.useState)(null),[D]=s.A.useForm(),[T,B]=(0,i.useState)(!1),[M,R]=(0,i.useState)(!1),[O,N]=(0,i.useState)(null),[J]=s.A.useForm(),[V]=s.A.useForm(),[K]=s.A.useForm(),[L]=s.A.useForm(),P=async t=>{if(t.wechat_name||t.sales_code)try{const n={};t.wechat_name&&(n.wechat_name=t.wechat_name),t.sales_code&&(n.sales_code=t.sales_code);const i=await e((0,C.wG)(n)).unwrap();if(!i||!i.sales)return void m.Ay.error("\u672a\u627e\u5230\u5339\u914d\u7684\u4e00\u7ea7\u9500\u552e\u6570\u636e");const{sales:a,orders:r,secondarySales:l,reminderOrders:o,stats:s}=i,d={data:r||[],total:r?r.length:0,page:1},c={totalCommission:(null===s||void 0===s?void 0:s.totalCommission)||0,monthlyCommission:(null===s||void 0===s?void 0:s.totalCommission)||0,totalOrders:(null===s||void 0===s?void 0:s.totalOrders)||0,monthlyOrders:(null===s||void 0===s?void 0:s.totalOrders)||0,secondarySales:l||[],pendingReminderCount:(null===s||void 0===s?void 0:s.pendingReminderCount)||0,monthlyReminderCount:(null===s||void 0===s?void 0:s.pendingReminderCount)||0,reminderSuccessRate:85,avgResponseTime:2.5,pendingReminderOrders:o||[]};u(a),Y(c),$(d),m.Ay.success("\u67e5\u8be2\u6210\u529f")}catch(n){m.Ay.error("\u67e5\u8be2\u5931\u8d25")}else m.Ay.error("\u8bf7\u8f93\u5165\u5fae\u4fe1\u53f7\u6216\u9500\u552e\u4ee3\u7801")},Q=[{title:"\u8ba2\u5355ID",dataIndex:"id",key:"id",width:80},{title:"\u5ba2\u6237\u5fae\u4fe1",dataIndex:"customer_wechat",key:"customer_wechat",width:120},{title:"TradingView\u7528\u6237\u540d",dataIndex:"tradingview_username",key:"tradingview_username",width:150},{title:"\u5957\u9910\u7c7b\u578b",dataIndex:"duration",key:"duration",width:100,render:e=>({"1month":"1\u4e2a\u6708","3months":"3\u4e2a\u6708","1year":"1\u5e74"}[e]||e)},{title:"\u8ba2\u5355\u91d1\u989d",dataIndex:"amount",key:"amount",width:100,render:e=>`$${parseFloat(e||0).toFixed(2)}`},{title:"\u4f63\u91d1\u91d1\u989d",dataIndex:"commission_amount",key:"commission_amount",width:100,render:e=>`$${parseFloat(e||0).toFixed(2)}`},{title:"\u4e8c\u7ea7\u9500\u552e",dataIndex:"secondary_sales_name",key:"secondary_sales_name",width:120,render:e=>e||"\u76f4\u63a5\u9500\u552e"},{title:"\u8ba2\u5355\u72b6\u6001",dataIndex:"status",key:"status",width:100,render:e=>{const t={pending_review:{text:"\u5f85\u5ba1\u6838",color:"orange"},pending_payment:{text:"\u5f85\u4ed8\u6b3e\u786e\u8ba4",color:"orange"},confirmed_payment:{text:"\u5df2\u4ed8\u6b3e\u786e\u8ba4",color:"blue"},pending_config:{text:"\u5f85\u914d\u7f6e\u786e\u8ba4",color:"purple"},confirmed_configuration:{text:"\u5df2\u914d\u7f6e\u786e\u8ba4",color:"green"},confirmed:{text:"\u5df2\u786e\u8ba4",color:"green"},approved:{text:"\u5df2\u901a\u8fc7",color:"green"},rejected:{text:"\u5df2\u62d2\u7edd",color:"red"},completed:{text:"\u5df2\u5b8c\u6210",color:"blue"},active:{text:"\u5df2\u751f\u6548",color:"green"},expired:{text:"\u5df2\u8fc7\u671f",color:"gray"},cancelled:{text:"\u5df2\u53d6\u6d88",color:"red"}}[e]||{text:e,color:"default"};return(0,F.jsx)(g.A,{color:t.color,children:t.text})}},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"created_at",key:"created_at",width:150,render:e=>{if(!e)return"-";const t=new Date(e);return isNaN(t.getTime())?"-":t.toLocaleString("zh-CN")}},{title:"\u64cd\u4f5c",key:"action",width:120,render:(e,t)=>(0,F.jsx)(y.A,{size:"small",children:(0,F.jsx)(a.Ay,{type:"primary",size:"small",onClick:()=>W(t),disabled:"cancelled"===t.status||"refunded"===t.status,children:"\u50ac\u5355"})})}],q=[{title:"\u5fae\u4fe1\u53f7",dataIndex:"wechat_name",key:"wechat_name",width:120},{title:"\u6536\u6b3e\u65b9\u5f0f",dataIndex:"payment_method",key:"payment_method",width:100,render:e=>({alipay:"\u652f\u4ed8\u5b9d",wechat:"\u5fae\u4fe1",crypto:"\u52a0\u5bc6\u8d27\u5e01"}[e]||e||"-")},{title:"\u603b\u8ba2\u5355\u91d1\u989d",dataIndex:"total_amount",key:"total_amount",width:120,render:e=>`$${parseFloat(e||0).toFixed(2)}`},{title:"\u5f53\u524d\u4f63\u91d1\u7387",dataIndex:"commission_rate",key:"commission_rate",width:100,render:e=>`${(100*e).toFixed(1)}%`},{title:"\u7d2f\u8ba1\u4f63\u91d1",dataIndex:"total_commission",key:"total_commission",width:100,render:e=>`$${parseFloat(e||0).toFixed(2)}`},{title:"\u8ba2\u5355\u6570\u91cf",dataIndex:"order_count",key:"order_count",width:100,render:e=>e||0},{title:"\u6ce8\u518c\u65f6\u95f4",dataIndex:"created_at",key:"created_at",width:150,render:e=>{if(!e)return"-";const t=new Date(e);return isNaN(t.getTime())?"-":t.toLocaleString("zh-CN")}},{title:"\u64cd\u4f5c",key:"action",width:200,render:(e,t)=>(0,F.jsxs)(y.A,{size:"small",children:[(0,F.jsx)(a.Ay,{type:"primary",size:"small",onClick:()=>E(t),children:"\u8bbe\u7f6e\u4f63\u91d1"}),(0,F.jsx)(a.Ay,{type:"default",size:"small",danger:!0,onClick:()=>G(t),children:"\u79fb\u9664"})]})}],E=e=>{N(e),J.setFieldsValue({commission_rate:100*e.commission_rate}),B(!0)},G=e=>{N(e),R(!0)},W=e=>{x.A.confirm({title:"\u786e\u8ba4\u50ac\u5355",content:`\u786e\u5b9a\u8981\u5411\u5ba2\u6237 ${e.customer_wechat} \u53d1\u9001\u50ac\u5355\u63d0\u9192\u5417\uff1f`,onOk:async()=>{try{m.Ay.success("\u50ac\u5355\u63d0\u9192\u5df2\u53d1\u9001")}catch(e){m.Ay.error("\u50ac\u5355\u5931\u8d25")}}})},X=e=>{if(e.payment_date_range){const[t,n]=e.payment_date_range;m.Ay.info(`\u641c\u7d22\u4ed8\u6b3e\u65f6\u95f4: ${t.format("YYYY-MM-DD")} \u81f3 ${n.format("YYYY-MM-DD")}`)}else m.Ay.info("\u663e\u793a\u5168\u90e8\u4e8c\u7ea7\u9500\u552e\u6570\u636e")},H=e=>{if(e.payment_date_range){const[t,n]=e.payment_date_range;m.Ay.info(`\u641c\u7d22\u4ed8\u6b3e\u65f6\u95f4: ${t.format("YYYY-MM-DD")} \u81f3 ${n.format("YYYY-MM-DD")}`)}else m.Ay.info("\u663e\u793a\u5168\u90e8\u8ba2\u5355\u6570\u636e")};return(0,F.jsxs)("div",{style:{padding:24},children:[(0,F.jsx)(b,{level:2,style:{marginBottom:24},children:"\u4e00\u7ea7\u9500\u552e\u5206\u9500\u7ba1\u7406\u548c\u5bf9\u8d26"}),(0,F.jsxs)(r.A,{title:"\u67e5\u8be2\u4e00\u7ea7\u9500\u552e\u4fe1\u606f",style:{marginBottom:24},children:[(0,F.jsxs)(s.A,{form:D,layout:"inline",onFinish:P,children:[(0,F.jsx)(s.A.Item,{name:"wechat_name",label:"\u5fae\u4fe1\u53f7",children:(0,F.jsx)(d.A,{placeholder:"\u8bf7\u8f93\u5165\u5fae\u4fe1\u53f7",style:{width:200},allowClear:!0,prefix:(0,F.jsx)(S.A,{})})}),(0,F.jsx)(s.A.Item,{name:"sales_code",label:"\u9500\u552e\u4ee3\u7801",children:(0,F.jsx)(d.A,{placeholder:"\u8bf7\u8f93\u5165\u9500\u552e\u4ee3\u7801",style:{width:200},allowClear:!0})}),(0,F.jsx)(s.A.Item,{children:(0,F.jsxs)(y.A,{children:[(0,F.jsx)(a.Ay,{type:"primary",htmlType:"submit",icon:(0,F.jsx)(v.A,{}),children:"\u67e5\u8be2"}),(0,F.jsx)(a.Ay,{onClick:()=>{D.resetFields(),u(null),Y(null),$(null),m.Ay.info("\u5df2\u91cd\u7f6e\u67e5\u8be2\u6761\u4ef6")},children:"\u91cd\u7f6e"})]})})]}),(0,F.jsx)("div",{style:{marginTop:16,color:"#666",fontSize:"14px"},children:"\ud83d\udca1 \u63d0\u793a\uff1a\u8f93\u5165\u4e00\u7ea7\u9500\u552e\u7684\u5fae\u4fe1\u53f7\u6216\u9500\u552e\u4ee3\u7801\uff0c\u67e5\u770b\u8be5\u9500\u552e\u7684\u5206\u9500\u6570\u636e\u548c\u4f63\u91d1\u5bf9\u8d26\u4fe1\u606f"})]}),!n&&(0,F.jsx)(r.A,{style:{marginBottom:24,textAlign:"center",background:"#f8f9fa"},children:(0,F.jsxs)("div",{style:{padding:"40px 20px"},children:[(0,F.jsx)(S.A,{style:{fontSize:"48px",color:"#ccc",marginBottom:16}}),(0,F.jsx)("h3",{style:{color:"#666",marginBottom:8},children:"\u8bf7\u5148\u67e5\u8be2\u4e00\u7ea7\u9500\u552e\u4fe1\u606f"}),(0,F.jsx)("p",{style:{color:"#999",margin:0},children:"\u8f93\u5165\u4e00\u7ea7\u9500\u552e\u7684\u5fae\u4fe1\u53f7\u6216\u9500\u552e\u4ee3\u7801\uff0c\u5373\u53ef\u67e5\u770b\u5206\u9500\u6570\u636e\u3001\u4f63\u91d1\u5bf9\u8d26\u548c\u50ac\u5355\u4fe1\u606f"})]})}),n&&(0,F.jsxs)(F.Fragment,{children:[(()=>{var e;return(0,F.jsxs)(h.A,{gutter:16,style:{marginBottom:24},children:[(0,F.jsx)(l.A,{span:4,children:(0,F.jsx)(r.A,{children:(0,F.jsx)(p.A,{title:"\u603b\u4f63\u91d1\u6536\u5165",value:(null===j||void 0===j?void 0:j.totalCommission)||0,precision:2,valueStyle:{color:"#3f8600"},prefix:(0,F.jsx)(f.A,{}),suffix:"\u5143"})})}),(0,F.jsx)(l.A,{span:4,children:(0,F.jsx)(r.A,{children:(0,F.jsx)(p.A,{title:"\u672c\u6708\u4f63\u91d1",value:(null===j||void 0===j?void 0:j.monthlyCommission)||0,precision:2,valueStyle:{color:"#1890ff"},prefix:(0,F.jsx)(f.A,{}),suffix:"\u5143"})})}),(0,F.jsx)(l.A,{span:4,children:(0,F.jsx)(r.A,{children:(0,F.jsx)(p.A,{title:"\u4f63\u91d1\u6bd4\u7387",value:(()=>{if(null===z||void 0===z||!z.data||0===z.data.length)return 40;const e=z.data;if(0===e.length)return 40;const t=e.filter(e=>!e.secondary_sales_name).reduce((e,t)=>e+t.amount,0),n=e.filter(e=>e.secondary_sales_name).reduce((e,t)=>e+t.amount,0);let i=0;if(null!==j&&void 0!==j&&j.secondarySales&&j.secondarySales.length>0){const e=j.secondarySales.map(e=>e.commission_rate);i=e.reduce((e,t)=>e+t,0)/e.length}const a=t+n;if(0===a)return 40;return((.4*t+n*((40-100*i)/100))/a*100).toFixed(1)})(),valueStyle:{color:"#52c41a",fontSize:"20px",fontWeight:"bold"},prefix:(0,F.jsx)(f.A,{}),suffix:"%"})})}),(0,F.jsx)(l.A,{span:6,children:(0,F.jsx)(r.A,{children:(0,F.jsx)(p.A,{title:"\u4e8c\u7ea7\u9500\u552e\u6570\u91cf",value:(null===j||void 0===j||null===(e=j.secondarySales)||void 0===e?void 0:e.length)||0,valueStyle:{color:"#722ed1"},prefix:(0,F.jsx)(k.A,{}),suffix:"\u4eba"})})}),(0,F.jsx)(l.A,{span:6,children:(0,F.jsx)(r.A,{children:(0,F.jsx)(p.A,{title:"\u603b\u8ba2\u5355\u6570",value:(null===j||void 0===j?void 0:j.totalOrders)||0,valueStyle:{color:"#fa8c16"},prefix:(0,F.jsx)(_.A,{}),suffix:"\u5355"})})})]})})(),(0,F.jsxs)(r.A,{title:"\u4e8c\u7ea7\u9500\u552e\u7ba1\u7406",style:{marginBottom:24},children:[(0,F.jsx)("div",{style:{marginBottom:16,padding:"16px",backgroundColor:"#fafafa",borderRadius:"6px"},children:(0,F.jsxs)(s.A,{form:K,layout:"inline",onFinish:X,children:[(0,F.jsx)(s.A.Item,{name:"payment_date_range",label:"\u4ed8\u6b3e\u65f6\u95f4",children:(0,F.jsx)(o.A.RangePicker,{style:{width:240},placeholder:["\u5f00\u59cb\u65f6\u95f4","\u7ed3\u675f\u65f6\u95f4"],format:"YYYY-MM-DD"})}),(0,F.jsx)(s.A.Item,{children:(0,F.jsxs)(y.A,{children:[(0,F.jsx)(a.Ay,{type:"primary",htmlType:"submit",icon:(0,F.jsx)(v.A,{}),children:"\u641c\u7d22"}),(0,F.jsx)(a.Ay,{onClick:()=>{K.resetFields(),X({})},children:"\u91cd\u7f6e"})]})})]})}),(0,F.jsx)(A.A,{columns:q,dataSource:(null===j||void 0===j?void 0:j.secondarySales)||[],rowKey:"id",loading:t,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`\u5171 ${e} \u6761\u8bb0\u5f55`}})]}),(0,F.jsxs)(r.A,{title:"\u6211\u7684\u8ba2\u5355\u5217\u8868",style:{marginBottom:24},children:[(0,F.jsx)("div",{style:{marginBottom:16,padding:"16px",backgroundColor:"#fafafa",borderRadius:"6px"},children:(0,F.jsxs)(s.A,{form:L,layout:"inline",onFinish:H,children:[(0,F.jsx)(s.A.Item,{name:"payment_date_range",label:"\u4ed8\u6b3e\u65f6\u95f4",children:(0,F.jsx)(o.A.RangePicker,{style:{width:240},placeholder:["\u5f00\u59cb\u65f6\u95f4","\u7ed3\u675f\u65f6\u95f4"],format:"YYYY-MM-DD"})}),(0,F.jsx)(s.A.Item,{children:(0,F.jsxs)(y.A,{children:[(0,F.jsx)(a.Ay,{type:"primary",htmlType:"submit",icon:(0,F.jsx)(v.A,{}),children:"\u641c\u7d22"}),(0,F.jsx)(a.Ay,{onClick:()=>{L.resetFields(),H({})},children:"\u91cd\u7f6e"})]})})]})}),(0,F.jsx)(A.A,{columns:Q,dataSource:(null===z||void 0===z?void 0:z.data)||[],rowKey:"id",loading:t,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`\u5171 ${e} \u6761\u8bb0\u5f55`,current:(null===z||void 0===z?void 0:z.page)||1,total:(null===z||void 0===z?void 0:z.total)||0}})]}),(0,F.jsxs)(r.A,{title:"\u50ac\u5355\u6570\u636e\u7edf\u8ba1",style:{marginBottom:24},children:[(0,F.jsx)(h.A,{gutter:16,style:{marginBottom:16},children:(0,F.jsx)(l.A,{span:8,children:(0,F.jsx)(r.A,{children:(0,F.jsx)(p.A,{title:"\u5f85\u50ac\u5355\u5ba2\u6237\u6570",value:(null===j||void 0===j?void 0:j.pendingReminderCount)||0,prefix:(0,F.jsx)(w.A,{}),valueStyle:{color:"#faad14"},suffix:"\u4e2a"})})})}),(0,F.jsx)(A.A,{title:()=>"\u5f85\u50ac\u5355\u8ba2\u5355\u5217\u8868",columns:[{title:"\u9500\u552e\u5fae\u4fe1\u53f7",dataIndex:"sales_wechat",key:"sales_wechat",width:120},{title:"\u5ba2\u6237\u5fae\u4fe1\u53f7",dataIndex:"customer_wechat",key:"customer_wechat",width:120},{title:"TradingView\u7528\u6237",dataIndex:"tradingview_username",key:"tradingview_username",width:150},{title:"\u8ba2\u5355\u91d1\u989d",dataIndex:"amount",key:"amount",width:100,render:e=>`$${parseFloat(e||0).toFixed(2)}`},{title:"\u5230\u671f\u65f6\u95f4",dataIndex:"expiry_time",key:"expiry_time",width:120,render:e=>e?new Date(e).toLocaleDateString():"-"},{title:"\u50ac\u5355\u72b6\u6001",dataIndex:"reminder_status",key:"reminder_status",width:100,render:e=>(0,F.jsx)(g.A,{color:e?"green":"orange",children:e?"\u5df2\u50ac\u5355":"\u5f85\u50ac\u5355"})}],dataSource:(null===j||void 0===j?void 0:j.pendingReminderOrders)||[],rowKey:"id",loading:t,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`\u663e\u793a ${t[0]}-${t[1]} \u6761\uff0c\u5171 ${e} \u6761\u8bb0\u5f55`,pageSizeOptions:["5","10","20","50"]}})]}),(0,F.jsx)(x.A,{title:"\u8bbe\u7f6e\u4f63\u91d1\u7387",open:T,onOk:async()=>{try{const e=(await J.validateFields()).commission_rate/100;if(j&&j.secondarySales){const t=j.secondarySales.map(t=>t.id===O.id?{...t,commission_rate:e}:t);Y({...j,secondarySales:t})}m.Ay.success("\u4f63\u91d1\u7387\u66f4\u65b0\u6210\u529f"),B(!1),J.resetFields()}catch(e){m.Ay.error("\u4f63\u91d1\u7387\u66f4\u65b0\u5931\u8d25: "+(e.message||e))}},onCancel:()=>{B(!1),J.resetFields()},okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",children:(0,F.jsxs)(s.A,{form:J,layout:"vertical",children:[(0,F.jsx)(s.A.Item,{label:"\u4e8c\u7ea7\u9500\u552e\u5fae\u4fe1\u53f7",children:(0,F.jsx)(d.A,{value:null===O||void 0===O?void 0:O.wechat_name,disabled:!0})}),(0,F.jsx)(s.A.Item,{name:"commission_rate",label:"\u4f63\u91d1\u7387 (%)",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4f63\u91d1\u7387"},{type:"number",min:0,max:100,message:"\u4f63\u91d1\u7387\u5fc5\u987b\u57280-100%\u4e4b\u95f4"}],children:(0,F.jsx)(c.A,{min:0,max:100,precision:2,placeholder:"\u8bf7\u8f93\u5165\u4f63\u91d1\u7387",style:{width:"100%"},formatter:e=>`${e}`,parser:e=>null===e||void 0===e?void 0:e.replace("%","")})})]})}),(0,F.jsxs)(x.A,{title:"\u786e\u8ba4\u79fb\u9664",open:M,onOk:async()=>{try{await e((0,C.JX)({secondarySalesId:O.id,reason:"\u4e00\u7ea7\u9500\u552e\u4e3b\u52a8\u79fb\u9664"})).unwrap(),m.Ay.success("\u4e8c\u7ea7\u9500\u552e\u79fb\u9664\u6210\u529f"),R(!1),n&&P()}catch(t){m.Ay.error("\u79fb\u9664\u5931\u8d25: "+(t.message||t))}},onCancel:()=>R(!1),okText:"\u786e\u5b9a\u79fb\u9664",cancelText:"\u53d6\u6d88",okButtonProps:{danger:!0},children:[(0,F.jsxs)("p",{children:["\u786e\u5b9a\u8981\u79fb\u9664\u4e8c\u7ea7\u9500\u552e ",(0,F.jsx)("strong",{children:null===O||void 0===O?void 0:O.wechat_name})," \u5417\uff1f"]}),(0,F.jsxs)("p",{style:{color:"#ff4d4f"},children:[(0,F.jsx)(w.A,{})," \u79fb\u9664\u540e\u5c06\u65e0\u6cd5\u6062\u590d\uff0c\u8be5\u4e8c\u7ea7\u9500\u552e\u7684\u6240\u6709\u8ba2\u5355\u5c06\u8f6c\u4e3a\u76f4\u63a5\u9500\u552e\u3002"]})]})]})]})}},9470:(e,t,n)=>{n.d(t,{A:()=>s});var i=n(8168),a=n(5043);const r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"};var l=n(2172),o=function(e,t){return a.createElement(l.A,(0,i.A)({},e,{ref:t,icon:r}))};const s=a.forwardRef(o)}}]);
//# sourceMappingURL=421.ae8a08b0.chunk.js.map