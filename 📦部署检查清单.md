# 📦 线上地址收款 Name 字段修复 - 部署检查清单

## 修复内容确认 ✅

### 已修改文件：
- ✅ `client/src/pages/SalesPage.js` - 一级销售注册页面
- ✅ `client/src/pages/UnifiedSecondarySalesPage.js` - 二级销售注册页面

### 修复逻辑：
```javascript
// 仅在线上地址码收款时，自动填充 name 字段
if (values.payment_method === 'crypto' && !values.name) {
  submitData.name = values.wechat_name || '线上客户';
}
```

## 部署前检查 📋

- [x] 代码修改完成
- [x] 保持支付宝收款逻辑不变
- [x] 线上地址码自动填充 name 字段
- [ ] 本地测试通过
- [ ] 构建无错误

## 部署步骤 🚀

### 1. 提交代码
```bash
git add client/src/pages/SalesPage.js
git add client/src/pages/UnifiedSecondarySalesPage.js
git commit -m "fix: 修复线上地址收款时name字段为null的问题

- 线上地址码收款时自动使用wechat_name作为name字段值
- 保持支付宝收款逻辑不变（仍需填写收款人姓名）
- 适用于一级和二级销售注册页面"

git push origin main
```

### 2. Vercel 自动部署
- 推送后 Vercel 会自动触发部署
- 部署时间：约 1-2 分钟
- 部署地址：https://zhixing-seven.vercel.app

### 3. 部署后验证
访问生产环境进行测试：

#### 测试1：线上地址码收款（重点）
1. 访问 https://zhixing-seven.vercel.app/sales
2. 填写微信号：`test_user_001`
3. 选择收款方式：`线上地址码`
4. 填写收款地址：`0x123...`
5. 点击提交
6. **预期结果**：成功创建，不再报 name 字段错误

#### 测试2：支付宝收款（确认未受影响）
1. 访问 https://zhixing-seven.vercel.app/sales
2. 填写微信号：`test_user_002`
3. 选择收款方式：`支付宝`
4. 填写支付宝账号和收款人姓名
5. 点击提交
6. **预期结果**：正常工作，姓名字段正常保存

## 回滚方案 🔄

如果出现问题，可以快速回滚：

```bash
# 查看提交历史
git log --oneline -5

# 回滚到修复前的版本
git revert HEAD
git push origin main
```

## 监控要点 📊

部署后需要监控：
1. **错误日志**：查看是否还有 "null value in column name" 错误
2. **成功率**：监控销售注册的成功率
3. **用户反馈**：关注是否有用户报告问题

## 状态
- 🟢 **准备就绪** - 可以部署
- 修复时间：2024-12-XX
- 修复人：AI Assistant
- 审核人：用户确认

---

### 备注
- 这是一个最小化的修复，只处理了核心问题
- 未来可以考虑在数据库层面添加触发器作为额外保护
- 如需进一步优化，可以考虑统一 name 字段的处理逻辑
