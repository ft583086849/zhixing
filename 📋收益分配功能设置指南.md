# 📋 收益分配功能设置指南

## 功能说明
财务统计页面的"确认按钮"（保存分配方案）已经完整实现，现在可以将收益分配比例保存到数据库中。

## 🚀 设置步骤

### 1. 创建数据库表
1. 登录到您的 Supabase 控制台
2. 进入 SQL 编辑器
3. 复制并运行 `🔧创建收益分配表.sql` 文件中的所有SQL代码
4. 确认表创建成功

### 2. 验证表创建
运行以下SQL查询确认表已创建：
```sql
SELECT * FROM profit_distribution;
```
应该看到一条默认记录：
- public_ratio: 40.00
- zhixing_ratio: 35.00  
- zijun_ratio: 25.00
- is_active: true

### 3. 刷新网站
访问 https://zhixing-seven.vercel.app/admin/finance

### 4. 使用方法
1. **调整比例**：
   - 在收益分配表格中调整三个滑块
   - 总和建议为100%

2. **保存配置**：
   - 点击"保存分配方案"按钮
   - 如果总和不是100%，会有提醒
   - 保存成功后会显示"已保存"

3. **查看历史**：
   可以在数据库中查看所有历史配置：
   ```sql
   SELECT * FROM profit_distribution 
   ORDER BY created_at DESC;
   ```

## ✨ 功能特点

1. **数据持久化**：
   - 配置保存在数据库中
   - 不会因为清除缓存而丢失

2. **版本管理**：
   - 每次保存创建新记录
   - 保留历史版本
   - 通过is_active标识当前版本

3. **备份机制**：
   - 同时保存到localStorage作为备份
   - 如果数据库出问题，还能从本地恢复

4. **实时计算**：
   - 根据保存的比例实时计算分配金额
   - 自动更新显示

## 🔍 数据库字段说明

| 字段 | 类型 | 说明 |
|-----|------|-----|
| id | UUID | 主键，自动生成 |
| public_ratio | DECIMAL(5,2) | 公户占比（%） |
| zhixing_ratio | DECIMAL(5,2) | 知行占比（%） |
| zijun_ratio | DECIMAL(5,2) | 子俊占比（%） |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |
| created_by | TEXT | 创建者 |
| is_active | BOOLEAN | 是否为当前配置 |

## ⚠️ 注意事项

1. 第一次使用前必须创建数据库表
2. 如果修改了比例但没保存，刷新页面会丢失更改
3. 建议总和保持100%，否则会有警告提示

## 🛠️ 故障排除

如果保存失败：
1. 检查数据库表是否创建成功
2. 检查网络连接
3. 查看浏览器控制台错误信息
4. 尝试刷新页面重试

## 📞 技术支持

如遇到问题，请提供：
- 错误截图
- 控制台错误信息
- 操作步骤描述
