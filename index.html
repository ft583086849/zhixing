<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>项目结构假设验证</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 800px; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { padding: 15px; margin: 10px 0; border-radius: 5px; font-weight: bold; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .testing { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .results { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 项目结构假设验证</h1>
        <p><strong>假设：</strong>添加根目录index.html后，Vercel会正确识别为前端项目，API也能工作</p>
        
        <div class="status testing" id="status">
            准备测试 API 连接性...
        </div>

        <div>
            <button onclick="testAPI('/api/test')">测试 /api/test</button>
            <button onclick="testAPI('/api/health')">测试 /api/health</button>
            <button onclick="testAPI('/api/admin?action=overview')">测试 /api/admin</button>
            <button onclick="runAllTests()">运行所有测试</button>
        </div>

        <div class="results" id="results"></div>
    </div>

    <script>
        const statusEl = document.getElementById('status');
        const resultsEl = document.getElementById('results');
        
        async function testAPI(endpoint) {
            statusEl.className = 'status testing';
            statusEl.textContent = `测试中: ${endpoint}...`;
            
            try {
                const startTime = performance.now();
                const response = await fetch(endpoint);
                const endTime = performance.now();
                const responseTime = (endTime - startTime).toFixed(0);
                
                const data = await response.text();
                const status = response.status;
                
                let result = `\n[${new Date().toLocaleTimeString()}] ${endpoint}\n`;
                result += `状态码: ${status} | 响应时间: ${responseTime}ms\n`;
                result += `响应: ${data.substring(0, 200)}${data.length > 200 ? '...' : ''}\n`;
                result += `${'='.repeat(50)}\n`;
                
                resultsEl.textContent += result;
                resultsEl.scrollTop = resultsEl.scrollHeight;
                
                if (status === 200) {
                    statusEl.className = 'status success';
                    statusEl.textContent = `✅ ${endpoint} 成功响应！`;
                } else {
                    statusEl.className = 'status error';
                    statusEl.textContent = `❌ ${endpoint} 返回 ${status}`;
                }
                
                return { endpoint, status, responseTime, data };
                
            } catch (error) {
                const result = `\n[${new Date().toLocaleTimeString()}] ${endpoint}\n`;
                result += `错误: ${error.message}\n`;
                result += `${'='.repeat(50)}\n`;
                
                resultsEl.textContent += result;
                
                statusEl.className = 'status error';
                statusEl.textContent = `❌ ${endpoint} 连接失败: ${error.message}`;
                
                return { endpoint, error: error.message };
            }
        }
        
        async function runAllTests() {
            resultsEl.textContent = '🧪 开始项目结构假设验证测试...\n' + '='.repeat(50) + '\n';
            
            const endpoints = [
                '/api/test',
                '/api/health', 
                '/api/admin?action=overview'
            ];
            
            const results = [];
            for (const endpoint of endpoints) {
                const result = await testAPI(endpoint);
                results.push(result);
                await new Promise(resolve => setTimeout(resolve, 1000)); // 1秒间隔
            }
            
            // 生成测试报告
            const successCount = results.filter(r => r.status === 200).length;
            const totalCount = results.length;
            const successRate = (successCount / totalCount * 100).toFixed(1);
            
            let report = `\n🎯 验证结果报告:\n`;
            report += `成功率: ${successRate}% (${successCount}/${totalCount})\n`;
            report += `假设验证: ${successCount > 0 ? '✅ 部分成功 - 项目结构影响确实存在' : '❌ 失败 - 需要其他解决方案'}\n`;
            report += `${'='.repeat(50)}\n`;
            
            resultsEl.textContent += report;
            
            if (successCount > 0) {
                statusEl.className = 'status success';
                statusEl.textContent = `🎉 假设验证成功！${successCount}个API可用`;
            } else {
                statusEl.className = 'status error';
                statusEl.textContent = `❌ 假设验证失败，API仍然不可用`;
            }
        }
        
        // 页面加载时自动运行测试
        window.onload = function() {
            setTimeout(runAllTests, 1000);
        };
    </script>
</body>
</html>