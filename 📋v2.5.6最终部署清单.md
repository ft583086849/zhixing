# 📋 v2.5.6 最终部署清单

## 🚀 版本信息
- **版本号**: v2.5.6
- **发布时间**: 2025-01-11
- **重要等级**: ⭐⭐⭐⭐⭐ 高

## ✅ 已完成的修改

### 1️⃣ 订单管理页面优化
✅ **新增字段和调整**
- 新增"销售类型"列（一级/二级/独立）
- 修正"销售微信号"显示实际出单人
- 修正"一级销售微信"显示逻辑
- 字段顺序：销售类型 → 销售微信号 → 一级销售微信号

### 2️⃣ 销售管理页面优化
✅ **新增收款信息字段**
- 收款链名（TRC20/BSC/支付宝等）
- 收款地址（支持一键复制）
- 位置：在"待返佣状态"之前

✅ **修复输入框问题**
- 佣金率输入框宽度从80px增加到120px

### 3️⃣ 购买页面新功能
✅ **7天免费订单特殊处理**
- 检查重复提交：同一TradingView用户名只能提交一次7天免费订单
- 特殊提示框："您的订单已提交，将在当日为您配置完成。请后续关注TradingView里指标，仅限邀请项的内容。"
- 重复提交提示："您已提交过7天免费订单，请进行续费"

## 🔄 修改的文件清单

```
client/src/components/admin/AdminOrders.js
  - 行214-293: 新增销售类型列，调整显示逻辑
  
client/src/components/admin/AdminSales.js
  - 行461: 佣金率输入框宽度调整
  - 行543-611: 新增收款链名和地址列
  
client/src/pages/PurchasePage.js
  - 行38: 添加SupabaseService导入
  - 行156-189: 7天免费订单重复检查逻辑
  - 行232-246: 7天免费订单特殊提示
```

## 📊 核心逻辑说明

### 佣金分配规则（已确认）
```
总佣金池 = 40%

分配方式：
- 一级自己卖：一级拿40%
- 二级卖（25%佣金）：
  * 二级拿25%
  * 一级拿15%（40% - 25%）
```

### 销售搜索逻辑（已存在）
```javascript
// client/src/services/api.js 697-728行
搜索一级销售时：
1. 匹配一级销售（支持部分匹配）
2. 自动包含其下属二级销售
3. 支持wechat_name、name、sales_code多字段搜索
```

### 收款信息来源
```
从销售注册时填写的数据：
- primary_sales表：payment_method, payment_account
- secondary_sales表：payment_method, payment_account
```

## ⚠️ 待解决问题

### 1. 佣金率显示不一致（2.5% vs 15%）
**问题根源**：动态计算公式与业务逻辑不符
**建议方案**：
1. 移除动态计算，使用固定分配规则
2. 或统一使用一级销售对账页面的数据源

### 2. 数据源不统一
**当前状况**：
- 管理员销售页面：使用AdminAPI.getSales
- 一级对账页面：使用getPrimarySalesSettlement
**建议**：统一数据源，确保一致性

## 📝 测试要点

### 订单管理
- [ ] wxq8854订单显示正确（Liangjunhao889为销售，张子俊为一级）
- [ ] 销售类型标签正确
- [ ] 一级销售微信显示逻辑正确

### 销售管理
- [ ] 佣金率输入框可正常输入
- [ ] 收款信息正确显示
- [ ] 地址复制功能正常
- [ ] 搜索一级销售时包含二级

### 购买页面
- [ ] 7天免费订单首次提交成功
- [ ] 重复提交显示正确提示
- [ ] 特殊提示框正确显示

## 🚨 重要提醒

1. **特殊佣金率设置**
   - 张子俊：0%
   - Liangjunhao889：0%
   - 需确认这些设置已生效

2. **销售搜索功能**
   - 搜索逻辑已存在于api.js中
   - 如仍有问题，可能是缓存或前端调用问题

3. **佣金计算逻辑**
   - 强烈建议统一使用一级对账页面逻辑
   - 避免多处计算导致的不一致

## 📞 部署后验证

请在部署后立即验证：
1. 订单管理页面销售关系显示
2. 销售管理页面佣金率和收款信息
3. 7天免费订单的提交和重复检查
4. 销售搜索功能（一级带二级）
