# 佣金系统计算逻辑文档

## 更新日期：2025-01-18

## 一、佣金体系概述

系统采用两级分销体系，总佣金率固定为订单金额的40%。

### 重要概念：平均二级佣金率的含义
在测试页面中显示的"平均二级佣金"有两种理解：
- **显示25%**：表示二级销售自己的平均佣金率（二级销售实际拿到的比例）
- **显示15%**：表示一级销售从团队订单赚的差价率（一级销售的额外收益）

## 二、销售角色定义

1. **一级销售（Primary Sales）**
   - 最高级别的销售人员
   - 可以发展二级销售
   - 直接销售时获得40%佣金
   - 二级销售出单时获得差额佣金

2. **二级销售（Secondary Sales）**
   - 由一级销售发展的销售人员
   - 有明确的上级一级销售
   - 佣金率由上级一级销售设定，默认25%

3. **独立销售（Independent Sales）**
   - 没有上级的二级销售
   - 独立运作，获得全部40%佣金

## 三、佣金计算规则

### 1. 一级销售直接销售
- **一级销售佣金** = 订单金额 × 40%
- **二级销售佣金** = 0（无二级参与）

### 2. 二级销售销售（有上级一级销售）
- **二级销售佣金** = 订单金额 × 二级销售佣金率（默认25%，可由一级调整）
- **一级销售佣金** = 订单金额 × (40% - 二级销售佣金率)
- **总佣金** = 一级销售佣金 + 二级销售佣金 = 订单金额 × 40%

### 3. 独立销售销售
- **独立销售佣金** = 订单金额 × 40%
- **一级销售佣金** = 0（无一级销售）

## 四、计算示例

假设订单金额：$1000

### 示例1：一级销售直接销售
- 一级销售佣金：$1000 × 40% = $400
- 二级销售佣金：$0
- 总佣金：$400

### 示例2：二级销售销售（佣金率25%）
- 二级销售佣金：$1000 × 25% = $250
- 一级销售佣金：$1000 × (40% - 25%) = $150
- 总佣金：$400

### 示例3：二级销售销售（佣金率30%）
- 二级销售佣金：$1000 × 30% = $300
- 一级销售佣金：$1000 × (40% - 30%) = $100
- 总佣金：$400

### 示例4：独立销售销售
- 独立销售佣金：$1000 × 40% = $400
- 一级销售佣金：$0
- 总佣金：$400

## 五、系统实现位置

### 前端显示逻辑
- 文件：`/client/src/components/admin/AdminOrders.js`
- 列：一级销售佣金额、二级分销佣金额

### 数据库字段
- `sales_type`：销售类型（primary/secondary/independent）
- `commission_rate`：二级销售的佣金率
- `amount`：订单金额
- `primary_sales_id`：一级销售ID
- `secondary_sales_id`：二级销售ID

## 六、业务逻辑要点

1. **总佣金恒定**：无论如何分配，公司支付的总佣金始终是订单金额的40%

2. **激励机制**：
   - 一级销售有动力直接销售（获得全部40%）
   - 一级销售有动力发展二级（虽然分出部分佣金，但扩大销售渠道）
   - 二级销售有动力销售（获得自己的佣金比例）

3. **佣金率调整**：
   - 一级销售可以调整其二级销售的佣金率
   - 调高二级佣金率：激励二级销售，但减少自己的差额佣金
   - 调低二级佣金率：增加自己的差额佣金，但可能降低二级销售积极性

## 七、注意事项

1. 所有佣金计算基于订单的 `amount` 字段
2. 佣金显示保留两位小数
3. 独立销售虽然属于二级销售表，但佣金计算等同于一级销售
4. 系统需要确保 `commission_rate` 不超过40%，否则一级销售会亏损