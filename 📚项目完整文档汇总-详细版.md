# 📚 知行财库React应用 - 完整项目文档（详细版）

> 生成时间：2025-01-13  
> 项目版本：v2.12.0  
> 项目名称：zhixing-react-app  
> GitHub：https://github.com/ft583086849/zhixing.git

---

## 📋 目录

1. [项目概述](#项目概述)
2. [详细页面功能说明](#详细页面功能说明)
3. [核心业务规则](#核心业务规则)
4. [技术架构详解](#技术架构详解)
5. [数据库设计](#数据库设计)
6. [API接口文档](#api接口文档)
7. [错误处理和修复记录](#错误处理和修复记录)
8. [部署和运维指南](#部署和运维指南)

---

## 🎯 项目概述

### 项目定位
知行财库是一个专门为TradingView指标订阅业务设计的销售管理系统，提供完整的销售链接生成、订单管理、佣金计算和财务对账功能。

### 核心特性
- 🔗 **多层级销售体系**：支持一级销售、二级销售、独立销售
- 💰 **智能佣金计算**：区分直销和分销收益，透明化管理
- 🔐 **安全支付系统**：支持加密货币链上支付（虽然代码中有支付宝痕迹，但已移除）
- 📊 **实时数据统计**：订单、收入、佣金实时更新
- 📱 **响应式设计**：支持移动端和PC端访问

### 技术栈概览
- **前端框架**：React 18 + Redux Toolkit
- **UI组件库**：Ant Design v5
- **后端服务**：Supabase (PostgreSQL + Auth + Storage)
- **部署平台**：Vercel + Supabase Cloud

---

## 📱 详细页面功能说明

### 1. 用户购买页面 `/purchase/:linkCode`

#### 页面功能
- 通过销售链接进入购买流程
- 显示销售人员信息
- 选择订阅时长和支付方式
- 上传付款截图
- 提交订单

#### 订单类型和价格
| 订阅时长 | 价格(USD) | 说明 |
|---------|-----------|------|
| 7天免费试用 | $0 | 无需付款，直接进入待配置 |
| 1个月 | $188 | 月度订阅 |
| 3个月 | $488 | 季度订阅 |
| 6个月 | $888 | 半年订阅 |
| 1年 | $1588 | 年度订阅 |

#### 支付方式
- **链上地址支付**（唯一支持的支付方式）
  - ERC20链（以太坊）
  - TRC20链（波场）
  - BSC链（币安智能链）
- 支持USDT/USDC稳定币
- **注意**：虽然代码中有支付宝相关代码，但功能已被移除

#### 购买流程
1. 选择订阅时长
2. 填写客户信息（微信号、TradingView用户名）
3. 选择支付链（ERC20/TRC20）
4. 复制收款地址进行转账
5. 上传付款截图
6. 提交订单等待确认

---

### 2. 销售注册页面

#### 2.1 一级销售注册 `/sales`
**页面标题**：高阶销售注册

**功能描述**：
- 一级销售自主注册
- 生成专属销售链接
- 设置收款信息

**必填信息**：
- 微信号
- 链名（如ERC20、TRC20、BSC）
- 收款地址（加密货币地址）

**生成内容**：
- 唯一销售链接：`/purchase/{linkCode}`
- 二级销售注册链接：`/secondary-sales?code={registrationCode}`
- 链接二维码

#### 2.2 二级销售注册 `/secondary-sales`
**页面标题**：二级销售注册

**功能描述**：
- 通过一级销售的注册码注册
- 自动关联上级销售
- 设置个人收款信息

**注册方式**：
1. **关联注册**：通过一级销售提供的注册码
2. **独立注册**：成为独立销售（无上级）

**必填信息**：
- 微信号
- 注册码（关联注册时需要）
- 链名
- 收款地址

---

### 3. 管理员后台 `/admin`

#### 3.1 数据概览 `/admin/dashboard`
**功能模块**：
- **统计卡片**
  - 总订单数
  - 总收入（USD）
  - 总佣金
  - 待处理订单

- **订单类型分布**
  - 7天免费试用订单
  - 1个月订单占比
  - 3个月订单占比
  - 6个月订单占比
  - 1年订单占比

- **时间筛选**
  - 今日
  - 本周
  - 本月
  - 自定义时间范围

#### 3.2 订单管理 `/admin/orders`
**核心功能**：
- 查看所有订单列表
- 订单状态管理
- 付款截图查看
- 订单搜索和筛选
- 批量操作

**订单状态流转**：
```
待付款 → 已付款 → 待配置 → 已配置 → 已激活
     ↘ 已拒绝（任何阶段可拒绝）
```

**搜索筛选条件**：
- 客户微信
- TradingView用户名
- 销售微信
- 订单状态
- 时间范围
- 订单类型

**操作功能**：
- 确认付款
- 确认配置
- 拒绝订单
- 查看付款截图
- 编辑订单信息

#### 3.3 销售管理 `/admin/sales`
**功能描述**：
- 查看所有销售人员
- 管理销售层级关系
- 调整佣金率
- 查看业绩统计

**销售信息展示**：
- 销售ID和链接代码
- 微信号
- 销售类型（一级/二级/独立）
- 收款方式和地址
- 佣金率
- 订单统计
- 收入统计

**佣金率管理**：
| 销售类型 | 默认佣金率 | 可调整范围 | 说明 |
|---------|-----------|-----------|------|
| 一级销售 | 40% | 不可调 | 固定佣金率 |
| 二级销售 | 25% | 0-25% | 可由一级销售调整 |
| 独立销售 | 25% | 0-25% | 可由管理员调整 |

**批量操作**：
- 批量设置佣金率
- 批量更新销售信息
- 导出销售数据

#### 3.4 客户管理 `/admin/customers`
**功能模块**：
- 客户信息维护
- 订阅状态跟踪
- 到期提醒
- 续费管理

**客户信息**：
- 客户微信
- TradingView用户名
- 订阅类型和到期时间
- 历史订单记录
- 负责销售

**排序规则**：
- 按最新订单时间降序
- 优先显示近期活跃客户

#### 3.5 资金统计 `/admin/finance`
**财务指标**：
- 总收入（订单金额合计）
- 总实付金额（实际收到的钱）
- 销售佣金（已确认的佣金）
- 待发佣金（待确认的佣金）
- 净利润（收入-佣金）

**收益分配功能**：
- 基于总实付金额进行分配
- 默认分配比例：
  - 公户：40%
    - 营销费用：10%
    - 分红：15%
    - 开发费用：15%
  - 知行：35%
  - 子俊：25%
- 支持手动调整比例
- 实时计算分配金额
- 保存分配方案到数据库

#### 3.6 收款配置 `/admin/payment-config`
**配置内容**：
- 链上地址配置（ERC20）
- 第二链上地址配置（TRC20）
- 收款二维码上传
- 链名设置

**支持的链**：
- ERC20（以太坊）
- TRC20（波场）
- BSC（币安智能链）

---

### 4. 销售专用页面

#### 4.1 销售对账页面 `/sales-reconciliation`
**适用对象**：所有销售人员

**功能模块**：
- **订单统计**
  - 总订单数
  - 总订单金额
  - 返佣金额
  - 返佣比例

- **订单列表**
  - 客户信息
  - 订单详情
  - 佣金明细
  - 状态跟踪

- **搜索功能**
  - 按微信名搜索
  - 按链接代码搜索
  - 按时间筛选

#### 4.2 一级销售结算页面 `/primary-settlement`
**适用对象**：一级销售

**特殊功能**：
- **佣金明细**
  - 直销佣金（自己的订单×40%）
  - 分销收益（二级订单×(40%-二级佣金率)）
  - 总佣金

- **二级销售管理**
  - 查看下属二级销售
  - 调整二级销售佣金率（0-25%）
  - 查看二级销售业绩

- **结算申请**
  - 选择结算周期
  - 生成结算单
  - 提交结算申请

---

## 📐 核心业务规则

### 佣金计算规则

#### 一级销售佣金计算
```javascript
// 直销佣金：自己直接成交的订单
直销佣金 = 直销订单金额 × 40%

// 分销收益：下属二级销售的订单
分销收益 = Σ(二级订单金额 × (40% - 二级佣金率))

// 总佣金
总佣金 = 直销佣金 + 分销收益
```

#### 二级销售佣金计算
```javascript
佣金 = 订单金额 × 自己的佣金率（默认25%，范围0-25%）
```

#### 独立销售佣金计算
```javascript
佣金 = 订单金额 × 自己的佣金率（默认25%，范围0-25%）
```

### 订单处理规则

1. **7天免费试用**
   - 无需付款
   - 直接进入"待配置"状态
   - 不计入收入统计
   - 不产生佣金

2. **付费订单**
   - 必须上传付款截图
   - 管理员确认后进入"已付款"状态
   - 配置完成后进入"已配置"状态
   - 激活后开始计算订阅期限

3. **拒绝订单**
   - 可在任何阶段拒绝
   - 不计入任何统计
   - 不产生佣金
   - 保留记录供查询

### 销售层级规则

1. **一级销售**
   - 可以招募二级销售
   - 固定40%佣金率
   - 享受分销收益
   - 可调整二级销售佣金率

2. **二级销售**
   - 必须有上级（一级销售）
   - 默认25%佣金率
   - 可被上级调整佣金率（0-25%）
   - 只享受直销佣金

3. **独立销售**
   - 无上级关系
   - 默认25%佣金率
   - 可被管理员调整（0-25%）
   - 只享受直销佣金

---

## 🛠️ 技术架构详解

### 前端架构

#### 目录结构
```
client/src/
├── components/          # 组件目录
│   ├── admin/          # 管理员组件
│   │   ├── AdminOrders.js       # 订单管理
│   │   ├── AdminSales.js        # 销售管理
│   │   ├── AdminCustomers.js    # 客户管理
│   │   ├── AdminFinance.js      # 财务统计
│   │   ├── AdminOverview.js     # 数据概览
│   │   └── AdminPaymentConfig.js # 收款配置
│   └── common/         # 通用组件
│       ├── CommonButton.js      # 按钮组件
│       ├── CommonCard.js        # 卡片组件
│       ├── CommonForm.js        # 表单组件
│       ├── CommonTable.js       # 表格组件
│       └── LazyImage.js         # 图片懒加载
├── pages/              # 页面组件
│   ├── PurchasePage.js          # 购买页面
│   ├── SalesPage.js             # 一级销售注册
│   ├── UnifiedSecondarySalesPage.js # 二级销售注册
│   ├── SalesReconciliationPage.js   # 销售对账
│   ├── PrimarySalesSettlementPage.js # 一级结算
│   └── AdminDashboardPage.js    # 管理员后台
├── services/           # 服务层
│   ├── api.js                   # API封装
│   ├── api-unified.js           # 统一API
│   ├── supabase.js              # Supabase服务
│   └── auth.js                  # 认证服务
├── store/              # Redux状态管理
│   ├── index.js                 # Store配置
│   └── slices/                  # Redux切片
│       ├── authSlice.js         # 认证状态
│       ├── adminSlice.js        # 管理员状态
│       ├── salesSlice.js        # 销售状态
│       ├── ordersSlice.js       # 订单状态
│       └── paymentConfigSlice.js # 支付配置
├── utils/              # 工具函数
│   ├── commissionUtils.js       # 佣金计算
│   ├── dataRefresh.js           # 数据刷新
│   └── performance.js           # 性能优化
└── config/             # 配置文件
    ├── supabase.js              # Supabase配置
    └── cdn.js                   # CDN配置
```

#### 路由配置
```javascript
// 公开路由
<Route path="/" element={<HomePage />} />
<Route path="/purchase/:linkCode" element={<PurchasePage />} />
<Route path="/sales" element={<SalesPage />} />
<Route path="/secondary-sales" element={<UnifiedSecondarySalesPage />} />
<Route path="/sales-reconciliation" element={<SalesReconciliationPage />} />
<Route path="/primary-settlement" element={<PrimarySalesSettlementPage />} />

// 管理员路由（需要认证）
<Route path="/admin" element={<AdminLoginPage />} />
<Route path="/admin/*" element={<ProtectedRoute><AdminDashboardPage /></ProtectedRoute>}>
  <Route path="dashboard" element={<AdminOverview />} />
  <Route path="orders" element={<AdminOrders />} />
  <Route path="sales" element={<AdminSales />} />
  <Route path="customers" element={<AdminCustomers />} />
  <Route path="finance" element={<AdminFinance />} />
  <Route path="payment-config" element={<AdminPaymentConfig />} />
</Route>
```

### 状态管理设计

#### Redux Store结构
```javascript
{
  // 认证状态
  auth: {
    user: null,              // 当前用户信息
    token: null,             // JWT Token
    isAuthenticated: false,  // 认证状态
    loading: false,          // 加载状态
    error: null              // 错误信息
  },
  
  // 管理员状态
  admin: {
    stats: {                 // 统计数据
      totalOrders: 0,
      totalRevenue: 0,
      totalCommission: 0,
      pendingOrders: 0
    },
    orders: [],              // 订单列表
    sales: [],               // 销售列表
    customers: [],           // 客户列表
    loading: false,
    error: null
  },
  
  // 销售状态
  sales: {
    currentSales: null,      // 当前销售信息
    orders: [],              // 销售订单
    commission: {            // 佣金信息
      direct: 0,             // 直销佣金
      distribution: 0,       // 分销收益
      total: 0               // 总佣金
    },
    secondarySales: [],      // 二级销售列表
    loading: false
  },
  
  // 订单状态
  orders: {
    list: [],                // 订单列表
    current: null,           // 当前订单
    filters: {               // 筛选条件
      status: '',
      dateRange: [],
      salesCode: ''
    },
    pagination: {            // 分页信息
      current: 1,
      pageSize: 10,
      total: 0
    }
  },
  
  // 支付配置
  paymentConfig: {
    crypto_chain_name: '',   // 链名
    crypto_address: '',      // 收款地址
    crypto_qr_code: '',      // 二维码
    crypto2_chain_name: '',  // 第二链名
    crypto2_address: '',     // 第二地址
    crypto2_qr_code: '',     // 第二二维码
    loading: false
  }
}
```

---

## 💾 数据库设计

### 核心表结构

#### sales表 - 销售人员信息
```sql
CREATE TABLE sales (
  id SERIAL PRIMARY KEY,
  wechat_name VARCHAR(100),         -- 微信号
  payment_method VARCHAR(50),       -- 收款方式（crypto）
  payment_address VARCHAR(200),     -- 收款地址
  chain_name VARCHAR(50),           -- 链名
  link_code VARCHAR(50) UNIQUE,     -- 唯一链接代码
  registration_code VARCHAR(50),    -- 注册码（用于招募二级）
  parent_sales_id INTEGER,          -- 上级销售ID
  sales_type VARCHAR(20),           -- 销售类型(primary/secondary/independent)
  commission_rate DECIMAL(5,4),     -- 佣金率(0.25表示25%)
  total_orders INTEGER DEFAULT 0,   -- 总订单数
  total_revenue DECIMAL(10,2),      -- 总收入
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  FOREIGN KEY (parent_sales_id) REFERENCES sales(id)
);

-- 索引
CREATE INDEX idx_sales_link_code ON sales(link_code);
CREATE INDEX idx_sales_registration_code ON sales(registration_code);
CREATE INDEX idx_sales_parent_id ON sales(parent_sales_id);
```

#### orders表 - 订单信息
```sql
CREATE TABLE orders (
  id SERIAL PRIMARY KEY,
  customer_wechat VARCHAR(100),      -- 客户微信
  tradingview_username VARCHAR(100), -- TradingView用户名
  duration VARCHAR(20),               -- 订阅时长(7days/1month/3months/6months/1year)
  amount DECIMAL(10,2),               -- 订单金额
  actual_payment_amount DECIMAL(10,2), -- 实际支付金额
  payment_method VARCHAR(50),         -- 支付方式
  payment_time TIMESTAMP,             -- 支付时间
  status VARCHAR(50),                 -- 订单状态
  sales_code VARCHAR(50),             -- 销售链接代码
  sales_id INTEGER,                   -- 销售ID
  sales_type VARCHAR(20),             -- 销售身份(primary/secondary)
  commission_amount DECIMAL(10,2),    -- 佣金金额
  screenshot_url TEXT,                -- 付款截图URL
  config_confirmed BOOLEAN DEFAULT FALSE, -- 配置确认
  purchase_type VARCHAR(20),          -- 购买类型(immediate/advance)
  effective_time TIMESTAMP,           -- 生效时间
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  FOREIGN KEY (sales_id) REFERENCES sales(id)
);

-- 索引
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_sales_code ON orders(sales_code);
CREATE INDEX idx_orders_created_at ON orders(created_at);
```

#### admins表 - 管理员
```sql
CREATE TABLE admins (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  username VARCHAR(50) UNIQUE,
  email VARCHAR(100),
  password_hash VARCHAR(255),
  role VARCHAR(20) DEFAULT 'admin',
  last_login TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### profit_distribution表 - 收益分配配置
```sql
CREATE TABLE profit_distribution (
  id SERIAL PRIMARY KEY,
  public_ratio DECIMAL(5,2) DEFAULT 40,      -- 公户占比
  marketing_ratio DECIMAL(5,2) DEFAULT 10,   -- 营销费用占比
  dividend_ratio DECIMAL(5,2) DEFAULT 15,    -- 分红占比
  development_ratio DECIMAL(5,2) DEFAULT 15, -- 开发费用占比
  zhixing_ratio DECIMAL(5,2) DEFAULT 35,     -- 知行占比
  zijun_ratio DECIMAL(5,2) DEFAULT 25,       -- 子俊占比
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

#### lifetime_limit表 - 永久授权限量（历史遗留）
```sql
-- 注：虽然已改为年费制，但数据库保留此表以兼容历史数据
CREATE TABLE lifetime_limit (
  id SERIAL PRIMARY KEY,
  total_limit INT DEFAULT 100,        -- 总限量
  used_count INT DEFAULT 0,           -- 已使用数量
  is_active BOOLEAN DEFAULT FALSE,    -- 是否启用（现已停用）
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

#### payment_config表 - 收款配置
```sql
CREATE TABLE payment_config (
  id SERIAL PRIMARY KEY,
  crypto_chain_name VARCHAR(50),      -- 链名
  crypto_address VARCHAR(200),        -- 收款地址
  crypto_qr_code TEXT,                -- 二维码base64
  crypto2_chain_name VARCHAR(50),     -- 第二链名
  crypto2_address VARCHAR(200),       -- 第二地址
  crypto2_qr_code TEXT,               -- 第二二维码
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### 数据库触发器

#### 自动更新config_confirmed字段
```sql
CREATE OR REPLACE FUNCTION update_config_confirmed()
RETURNS TRIGGER AS $$
BEGIN
  IF NEW.status IN ('confirmed_config', 'confirmed_configuration', 'active') THEN
    NEW.config_confirmed = true;
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER sync_config_confirmed
BEFORE UPDATE ON orders
FOR EACH ROW
EXECUTE FUNCTION update_config_confirmed();
```

---

## 🔌 API接口文档

### 认证相关接口

#### 管理员登录
```javascript
POST /api/auth/login
Body: {
  username: string,
  password: string
}
Response: {
  success: boolean,
  data: {
    user: object,
    token: string
  }
}
```

#### Token刷新
```javascript
POST /api/auth/refresh
Headers: {
  Authorization: 'Bearer {token}'
}
Response: {
  success: boolean,
  data: {
    token: string
  }
}
```

### 销售相关接口

#### 注册一级销售
```javascript
POST /api/sales/register
Body: {
  wechat_name: string,
  payment_method: 'crypto',
  payment_address: string,
  chain_name: string
}
Response: {
  success: boolean,
  data: {
    link_code: string,
    registration_code: string,
    purchase_link: string
  }
}
```

#### 注册二级销售
```javascript
POST /api/sales/register-secondary
Body: {
  wechat_name: string,
  payment_method: 'crypto',
  payment_address: string,
  chain_name: string,
  registration_code: string  // 可选，关联注册时需要
}
Response: {
  success: boolean,
  data: {
    link_code: string,
    purchase_link: string
  }
}
```

#### 获取销售统计
```javascript
GET /api/sales/stats?sales_code={code}
Response: {
  success: boolean,
  data: {
    total_orders: number,
    total_revenue: number,
    commission: {
      direct: number,
      distribution: number,
      total: number
    }
  }
}
```

### 订单相关接口

#### 创建订单
```javascript
POST /api/orders/create
Body: {
  customer_wechat: string,
  tradingview_username: string,
  duration: string,
  amount: number,
  payment_method: 'crypto',
  payment_time: string,
  screenshot_data: string,  // base64
  sales_code: string
}
Response: {
  success: boolean,
  data: {
    order_id: number,
    status: string
  }
}
```

#### 更新订单状态
```javascript
PUT /api/admin/orders/{id}
Body: {
  status: string
}
Response: {
  success: boolean,
  message: string
}
```

### 管理接口

#### 获取统计数据
```javascript
GET /api/admin/stats
Response: {
  success: boolean,
  data: {
    total_orders: number,
    total_revenue: number,
    total_commission: number,
    pending_orders: number,
    order_distribution: {
      free_trial: number,
      one_month: number,
      three_months: number,
      six_months: number,
      yearly: number
    }
  }
}
```

#### 获取销售列表
```javascript
GET /api/admin/sales?page=1&limit=10
Response: {
  success: boolean,
  data: {
    sales: array,
    total: number,
    page: number,
    limit: number
  }
}
```

#### 调整佣金率
```javascript
PUT /api/admin/sales/{id}/commission
Body: {
  commission_rate: number  // 0.25表示25%
}
Response: {
  success: boolean,
  message: string
}
```

---

## 🐛 错误处理和修复记录

### 主要问题修复历史

#### 1. 支付方式迁移 (v2.12.0)
**问题**：系统从支付宝+加密货币双支付改为纯加密货币支付
**解决**：
- 移除所有支付宝相关UI组件
- 保留数据库字段以兼容历史数据
- 统一payment_method为'crypto'

#### 2. 佣金率格式统一 (v2.11.1)
**问题**：佣金率存储格式混乱（0.25、25、2500同时存在）
**解决**：
- 统一为小数格式（0.25表示25%）
- 添加格式化函数处理显示
- 数据库迁移脚本修复历史数据

#### 3. 订单状态同步 (v2.11.0)
**问题**：config_confirmed字段未自动同步
**解决**：创建数据库触发器自动更新

#### 4. 销售层级关系 (v2.10.x)
**问题**：二级销售佣金计算错误
**解决**：
- 明确区分直销和分销
- 修复佣金计算公式
- 添加详细的佣金明细展示

### 常见错误处理

#### 前端错误处理
```javascript
// API请求错误处理
try {
  const response = await api.post('/orders/create', data);
  if (response.data.success) {
    message.success('订单创建成功');
  } else {
    message.error(response.data.message || '操作失败');
  }
} catch (error) {
  console.error('API Error:', error);
  message.error('网络错误，请稍后重试');
}

// Redux错误处理
.addCase(createOrder.rejected, (state, action) => {
  state.loading = false;
  state.error = action.payload || '创建订单失败';
})
```

#### 后端错误处理
```javascript
// Supabase错误处理
const { data, error } = await supabase
  .from('orders')
  .insert(orderData);

if (error) {
  console.error('Database Error:', error);
  throw new Error(error.message || '数据库操作失败');
}
```

---

## 🚀 部署和运维指南

### 开发环境设置

#### 环境要求
- Node.js >= 14.0.0
- npm >= 6.0.0
- Git

#### 本地开发
```bash
# 克隆项目
git clone https://github.com/ft583086849/zhixing.git
cd zhixing

# 安装依赖
npm install
cd client && npm install

# 配置环境变量
cp .env.example .env
# 编辑.env文件，填入Supabase配置

# 启动开发服务器
npm run dev

# 访问地址
# 前端：http://localhost:3000
```

### 生产环境部署

#### Vercel部署配置
```json
// vercel.json
{
  "version": 2,
  "name": "zhixing-react-app",
  "framework": "create-react-app",
  "buildCommand": "cd client && npm install && npm run build",
  "outputDirectory": "client/build",
  "installCommand": "cd client && npm install"
}
```

#### 环境变量配置
```bash
# Vercel环境变量
REACT_APP_SUPABASE_URL=your_supabase_url
REACT_APP_SUPABASE_ANON_KEY=your_anon_key
REACT_APP_SUPABASE_SERVICE_KEY=your_service_key
```

#### 部署流程
```bash
# 自动部署（推送到main分支）
git add .
git commit -m "feat: 新功能"
git push origin main

# 手动部署
vercel --prod

# 查看部署状态
vercel ls
```

### 数据库维护

#### 备份策略
- Supabase自动每日备份
- 重要更新前手动备份
- 保留30天备份历史

#### 数据迁移
```bash
# 执行SQL迁移
psql $DATABASE_URL < migration.sql

# 验证迁移结果
psql $DATABASE_URL -c "SELECT * FROM migrations;"
```

### 监控和告警

#### 性能监控
- Vercel Analytics：前端性能
- Supabase Metrics：数据库性能
- 自定义监控：API响应时间

#### 错误监控
- 前端错误：console.error日志
- 后端错误：Supabase日志
- 用户反馈：错误上报机制

#### 告警规则
- API响应时间 > 3秒
- 错误率 > 5%
- 数据库连接失败
- 磁盘使用率 > 80%

---

## 📈 版本更新历史

### v2.12.0 (2025-01-07)
- ✨ 佣金系统全面改进，区分直销和分销
- ✨ 移除支付宝，统一使用加密货币支付
- 🐛 修复佣金计算错误
- 📊 优化统计展示

### v2.11.x (2025-01-06)
- ✨ 添加config_confirmed自动同步触发器
- 🐛 修复佣金率显示为2500%的问题
- 🔧 统一佣金率存储格式

### v2.10.x (2025-01-05)
- ✨ 销售管理按创建时间排序
- ✨ 客户管理按最新订单排序
- 🐛 修复销售搜索功能
- 🎨 UI细节优化

### 更早版本
- 详见Git提交历史和部署清单文档

---

## 📞 联系和支持

### 技术支持
- 查看本文档获取详细信息
- 查看部署清单了解具体版本更新
- 查看错误记录了解历史问题

### 问题反馈
- GitHub Issues：https://github.com/ft583086849/zhixing/issues
- 技术支持邮箱：[待补充]

### 贡献指南
1. Fork项目
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建Pull Request

---

## 📄 许可证

MIT License

Copyright (c) 2025 知行财库

---

*本文档最后更新：2025-01-13*
*文档版本：v2.0.0*