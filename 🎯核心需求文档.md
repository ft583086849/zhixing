# 🎯 核心需求文档

> 创建时间：2025-01-07
> 状态：进行中
> 优先级：高

## 📌 当前进行中的需求

### 🔥 佣金系统全面改进（v2.0）
**目标**：让佣金计算透明化，区分直销和分销收益

#### 核心改动
1. **统一佣金率**
   - 所有一级销售：40%固定
   - 二级销售默认：25%
     - 可由所属一级在对账页面调整
     - 管理员可在销售管理页面调整
   - 独立销售默认：25%
     - 管理员可在销售管理页面调整

2. **页面改进**
   - 一级销售对账页面：添加佣金明细
   - 销售管理页面：拆分订单金额和佣金
   - 订单管理页面：区分直销和分销佣金

3. **计算逻辑**
   - 一级总佣金 = 直销佣金 + 分销收益
   - 直销佣金 = 自己的订单 × 40%
   - 分销收益 = 二级订单 × (40% - 二级佣金率)
   
4. **字段对齐原则**
   - 一级销售配置确认订单金额 = 总订单额 - 二级订单额（仅直销部分）
   - 二级销售配置确认订单金额 = 所有二级的订单总额
   - 这样确保：订单金额字段 ↔ 佣金字段完美对应

**相关文档**：`📋完整佣金系统改进方案v2.md`

---

## 📋 待处理需求队列

### 1. 7天免费转收费统计页面
**描述**：追踪免费试用到付费的转化率
**所需信息**：
- TradingView用户名
- 订单时间（免费→付费）
- 转化天数
- 负责销售
**优先级**：中

### 2. 数据导出功能
**描述**：支持导出各类报表数据
**范围**：
- 销售业绩报表
- 订单明细
- 佣金结算单
**优先级**：低

---

## ✅ 已完成需求

### v2.11.1 - config_confirmed字段同步
- 创建触发器自动同步订单状态
- 确保数据一致性

### v2.10.x - 排序和搜索优化
- 销售管理按创建时间排序
- 客户管理按最新订单排序
- 销售搜索支持智能匹配

### v2.9.0 - Dashboard点击跳转
- 待付款订单点击跳转到订单页面
- 销售返佣金额点击跳转到销售管理

### v2.8.0 - 财务统计增强
- 添加收益分配方案
- 支持手动调整已分配金额

### v2.7.0 - 二级销售默认佣金率
- 统一默认为25%
- 修复2500%显示bug

---

## 🔧 系统优化需求

### 性能优化
- [ ] API响应缓存优化
- [ ] 前端数据刷新机制
- [ ] 大数据量分页加载

### 用户体验
- [ ] 移动端响应式优化
- [ ] 加载状态提示
- [ ] 错误提示优化

### 数据准确性
- [x] 佣金率格式统一（0.x格式）
- [ ] 订单去重机制
- [x] 状态同步触发器

---

## 📊 业务规则汇总

### 佣金规则
| 销售类型 | 基础佣金率 | 计算方式 |
|---------|-----------|----------|
| 一级销售 | 40% | 直销40% + 分销差额 |
| 二级销售 | 25% | 订单×佣金率 |
| 独立销售 | 25% | 订单×佣金率 |

### 订单状态流转
```
pending_payment → confirmed_payment → pending_config → confirmed_config → active
                ↘ rejected（任何阶段可拒绝）
```

### 特殊规则
1. 7天免费订单直接进入`pending_config`状态
2. 支付宝金额需要÷7.15转换为美元
3. 已拒绝订单不计入任何统计

---

## 📝 需求变更记录

### 2025-01-07
- 明确佣金系统改进的所有细节
- 确定加权平均计算方式
- 统一"二级分销收益"字段含义

### 2025-01-06
- 添加config_confirmed触发器需求
- 优化排序逻辑
- 修复佣金率显示问题

---

## 🚀 下一步行动

1. **立即**：实施佣金系统改进v2.0
2. **本周**：完成所有页面的字段调整
3. **下周**：设计7天免费转收费统计页面

---

## 📞 联系和支持

- 技术问题：检查相关部署清单
- 业务逻辑：参考本文档的业务规则
- 实施细节：查看具体的改进方案文档
