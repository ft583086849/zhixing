# ğŸ“‹ é”€å”®å¾®ä¿¡å·è·å–é€»è¾‘è¯¦ç»†è¯´æ˜

## ğŸ¯ é—®é¢˜ï¼šå®¢æˆ·ç®¡ç†å’Œé”€å”®ç®¡ç†é‡Œçš„é”€å”®å¾®ä¿¡å·è·å–ä¸åˆ°

### ä¸€ã€å®¢æˆ·ç®¡ç†ä¸­çš„é”€å”®å¾®ä¿¡å·è·å–é€»è¾‘

**æ–‡ä»¶ä½ç½®ï¼š** `client/src/services/api.js` ç¬¬156-241è¡Œ `AdminAPI.getCustomers()`

**æ ¸å¿ƒé€»è¾‘ï¼š**
```javascript
// 1. è·å–æ•°æ®æº
const [ordersResult, primarySalesResult, secondarySalesResult] = await Promise.all([
  supabaseClient.from('orders').select('*'),
  supabaseClient.from('primary_sales').select('sales_code, name, wechat_name'),
  supabaseClient.from('secondary_sales').select('sales_code, name, wechat_name')
]);

// 2. åˆå¹¶é”€å”®æ•°æ®
const allSales = [...(primarySalesResult.data || []), ...(secondarySalesResult.data || [])];

// 3. å¯¹æ¯ä¸ªè®¢å•ï¼Œé€šè¿‡sales_codeæŸ¥æ‰¾é”€å”®å¾®ä¿¡å·
orders.forEach(order => {
  if (order.sales_code) {
    const matchingSale = allSales.find(sale => sale.sales_code === order.sales_code);
    if (matchingSale) {
      // ğŸ”§ å…³é”®ï¼šä¼˜å…ˆä½¿ç”¨nameå­—æ®µï¼Œå…¶æ¬¡wechat_name
      salesWechat = matchingSale.name || matchingSale.wechat_name || '-';
    }
  }
});
```

**æŸ¥è¯¢çš„å­—æ®µï¼š**
- `primary_sales` è¡¨ï¼š`sales_code, name, wechat_name`
- `secondary_sales` è¡¨ï¼š`sales_code, name, wechat_name`

**è·å–ä¼˜å…ˆçº§ï¼š**
1. `matchingSale.name` ï¼ˆç¬¬ä¸€ä¼˜å…ˆçº§ï¼‰
2. `matchingSale.wechat_name` ï¼ˆç¬¬äºŒä¼˜å…ˆçº§ï¼‰
3. `'-'` ï¼ˆé»˜è®¤å€¼ï¼‰

---

### äºŒã€é”€å”®ç®¡ç†ä¸­çš„é”€å”®å¾®ä¿¡å·è·å–é€»è¾‘

**æ–‡ä»¶ä½ç½®ï¼š** `client/src/services/api.js` ç¬¬304-496è¡Œ `AdminAPI.getSales()`

#### 2.1 ä¸€çº§é”€å”®å¾®ä¿¡å·è·å–ï¼ˆç¬¬370è¡Œï¼‰
```javascript
// ğŸ”§ ä¿®å¤ï¼šé€šè¿‡sales_codeåå‘è·å–é”€å”®å¾®ä¿¡å·
// ç¡®ä¿wechat_nameæœ‰å€¼ï¼Œå¦‚æœé”€å”®è¡¨ä¸­ä¸ºç©ºï¼Œä½¿ç”¨nameæˆ–phoneä½œä¸ºå¤‡é€‰
const wechatName = sale.wechat_name || sale.name || sale.phone || `ä¸€çº§é”€å”®-${sale.sales_code}`;

return {
  ...sale,
  wechat_name: wechatName, // ğŸ”§ ç¡®ä¿å¾®ä¿¡å·å­—æ®µæœ‰å€¼
  // ... å…¶ä»–å­—æ®µ
};
```

**ä¸€çº§é”€å”®è·å–ä¼˜å…ˆçº§ï¼š**
1. `sale.wechat_name` ï¼ˆç¬¬ä¸€ä¼˜å…ˆçº§ï¼‰
2. `sale.name` ï¼ˆç¬¬äºŒä¼˜å…ˆçº§ï¼‰
3. `sale.phone` ï¼ˆç¬¬ä¸‰ä¼˜å…ˆçº§ï¼‰
4. `ä¸€çº§é”€å”®-${sale.sales_code}` ï¼ˆé»˜è®¤å€¼ï¼‰

#### 2.2 äºŒçº§é”€å”®å¾®ä¿¡å·è·å–ï¼ˆç¬¬455è¡Œï¼‰
```javascript
// ğŸ”§ ä¿®å¤ï¼šé€šè¿‡sales_codeåå‘è·å–é”€å”®å¾®ä¿¡å·
// ç¡®ä¿wechat_nameæœ‰å€¼ï¼Œå¦‚æœé”€å”®è¡¨ä¸­ä¸ºç©ºï¼Œä½¿ç”¨nameæˆ–phoneä½œä¸ºå¤‡é€‰
const wechatName = sale.wechat_name || sale.name || sale.phone || `äºŒçº§é”€å”®-${sale.sales_code}`;

return {
  ...sale,
  wechat_name: wechatName, // ğŸ”§ ç¡®ä¿å¾®ä¿¡å·å­—æ®µæœ‰å€¼
  // ... å…¶ä»–å­—æ®µ
};
```

**äºŒçº§é”€å”®è·å–ä¼˜å…ˆçº§ï¼š**
1. `sale.wechat_name` ï¼ˆç¬¬ä¸€ä¼˜å…ˆçº§ï¼‰
2. `sale.name` ï¼ˆç¬¬äºŒä¼˜å…ˆçº§ï¼‰
3. `sale.phone` ï¼ˆç¬¬ä¸‰ä¼˜å…ˆçº§ï¼‰
4. `äºŒçº§é”€å”®-${sale.sales_code}` ï¼ˆé»˜è®¤å€¼ï¼‰

---

## ğŸ” éœ€è¦æ£€æŸ¥çš„æ•°æ®åº“å­—æ®µ

### 1. primary_sales è¡¨éœ€è¦æ£€æŸ¥çš„å­—æ®µï¼š
```sql
SELECT sales_code, name, wechat_name, phone FROM primary_sales LIMIT 5;
```

### 2. secondary_sales è¡¨éœ€è¦æ£€æŸ¥çš„å­—æ®µï¼š
```sql
SELECT sales_code, name, wechat_name, phone FROM secondary_sales LIMIT 5;
```

### 3. orders è¡¨éœ€è¦æ£€æŸ¥çš„å…³è”å­—æ®µï¼š
```sql
SELECT id, sales_code, customer_wechat, tradingview_username FROM orders LIMIT 5;
```

---

## ğŸš¨ å¯èƒ½çš„é—®é¢˜åŸå› 

1. **æ•°æ®åº“å­—æ®µä¸ºç©ºï¼š** `name`, `wechat_name`, `phone` å­—æ®µéƒ½æ˜¯ç©ºå€¼
2. **å…³è”å¤±è´¥ï¼š** `orders.sales_code` ä¸ `primary_sales.sales_code` / `secondary_sales.sales_code` ä¸åŒ¹é…
3. **æ•°æ®ç±»å‹é—®é¢˜ï¼š** å­—æ®µå€¼ä¸º `null`, `undefined`, æˆ–ç©ºå­—ç¬¦ä¸² `''`

---

## ğŸ“ è¯·å¸®æˆ‘æŸ¥è¯¢è¿™äº›æ•°æ®

è¯·åœ¨Supabaseæ§åˆ¶å°æˆ–æ•°æ®åº“å·¥å…·ä¸­æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢ï¼Œå‘Šè¯‰æˆ‘ç»“æœï¼š

```sql
-- 1. æ£€æŸ¥ä¸€çº§é”€å”®æ•°æ®
SELECT sales_code, name, wechat_name, phone, created_at 
FROM primary_sales 
ORDER BY created_at DESC 
LIMIT 5;

-- 2. æ£€æŸ¥äºŒçº§é”€å”®æ•°æ®  
SELECT sales_code, name, wechat_name, phone, created_at
FROM secondary_sales 
ORDER BY created_at DESC 
LIMIT 5;

-- 3. æ£€æŸ¥è®¢å•å…³è”
SELECT id, sales_code, customer_wechat, tradingview_username, created_at
FROM orders 
WHERE sales_code IS NOT NULL
ORDER BY created_at DESC 
LIMIT 5;

-- 4. æ£€æŸ¥å…³è”æƒ…å†µ
SELECT 
  o.sales_code,
  p.name as primary_name,
  p.wechat_name as primary_wechat,
  s.name as secondary_name,
  s.wechat_name as secondary_wechat
FROM orders o
LEFT JOIN primary_sales p ON o.sales_code = p.sales_code
LEFT JOIN secondary_sales s ON o.sales_code = s.sales_code
WHERE o.sales_code IS NOT NULL
LIMIT 5;
```

æŠŠè¿™äº›æŸ¥è¯¢ç»“æœå‘ç»™æˆ‘ï¼Œæˆ‘å°±èƒ½ç¡®å®šå…·ä½“é—®é¢˜åœ¨å“ªé‡Œäº†ï¼
