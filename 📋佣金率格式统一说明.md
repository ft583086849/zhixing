# 📋 佣金率格式统一说明

## 🎯 核心需求
**数据库统一存储小数格式（0.4表示40%），前端显示百分比（40%）**

## 📊 历史问题

### v2.5.1已实施的修复
- ✅ 前端代码已统一处理（转换为小数存储）
- ✅ 订单表正确使用小数格式
- ❌ 销售表SQL脚本未更新

### 导致的问题
```javascript
// 销售表存储：25（百分比）
// 前端误以为是0.25，再×100 = 2500%
```

## 🔧 完整解决方案

### 1. 数据库层面统一
```sql
-- 销售表应该使用
commission_rate DECIMAL(5,4) DEFAULT 0.4000  -- 不是40.00

-- 订单表已正确
commission_rate DECIMAL(5,4) DEFAULT 0.3000  -- ✅
```

### 2. 前端处理逻辑
```javascript
// 存储时（用户输入40%）
const rateToStore = userInput / 100;  // 40 → 0.4

// 显示时（数据库0.4）
const displayRate = dbValue * 100;    // 0.4 → 40%
```

### 3. 当前的临时修复
```javascript
// SalesReconciliationPage.js
value={salesData.commission_rate || 25}  // 直接使用，不×100

// 这是临时方案，因为销售表还是百分比格式
// 正确修复后应该是：
value={(salesData.commission_rate || 0.25) * 100}
```

## ⚠️ 重要提醒

### 为什么会出现不一致？
1. **需求已定**：v2.5.1已要求统一小数格式
2. **部分实施**：代码层面已改，订单表已改
3. **遗漏更新**：销售表的DDL脚本未更新

### 影响范围
- `primary_sales`表：仍用百分比（40.00）
- `secondary_sales`表：仍用百分比（25.00）
- `orders`表：正确使用小数（0.30）

## 📝 执行步骤

1. **执行数据库修改**
   ```bash
   执行：🔧统一佣金率存储格式为小数.sql
   ```

2. **更新前端代码**
   ```javascript
   // 所有显示佣金率的地方
   value={(data.commission_rate || 0) * 100}
   ```

3. **验证数据一致性**
   - 检查所有佣金率 < 1
   - 确认显示正常（0.4显示为40%）

## ✅ 最终状态

| 层面 | 格式 | 示例 |
|------|------|------|
| 数据库存储 | 小数 | 0.40 |
| API传输 | 小数 | 0.40 |
| 前端计算 | 小数 | 0.40 |
| 用户界面 | 百分比 | 40% |

**统一格式，避免混乱！**
