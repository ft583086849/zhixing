# ğŸ“Š å®¢æˆ·ç®¡ç†ä¸è®¢å•ç®¡ç†æ•°æ®å·®å¼‚åˆ†æ

## ğŸ”´ å‘ç°çš„é—®é¢˜

### æ ¸å¿ƒæ¡ˆä¾‹ï¼šfl261247
- **å®¢æˆ·ç®¡ç†æ˜¾ç¤º**ï¼šé”€å”®æ˜¯ fl261247ï¼ˆäºŒçº§ï¼‰
- **è®¢å•ç®¡ç†æ˜¾ç¤º**ï¼šé”€å”®æ˜¯ WML792355703ï¼ˆä¸€çº§ï¼‰

è¿™ä¸ªå·®å¼‚åæ˜ äº†ç³»ç»Ÿçš„ä¸€ä¸ªå…³é”®é—®é¢˜ã€‚

## ğŸ” ä¸¤ä¸ªé¡µé¢çš„å–æ•°é€»è¾‘å¯¹æ¯”

### 1ï¸âƒ£ å®¢æˆ·ç®¡ç†é¡µé¢ï¼ˆgetCustomersï¼‰

**æ–‡ä»¶**ï¼š`client/src/services/api.js` (è¡Œ211-466)

**é€»è¾‘æµç¨‹**ï¼š
1. è·å–æ‰€æœ‰è®¢å•
2. æŒ‰ `customer_wechat + tradingview_username` åˆ†ç»„ç”Ÿæˆå®¢æˆ·åˆ—è¡¨
3. é€šè¿‡è®¢å•çš„ `sales_code` æŸ¥æ‰¾é”€å”®ä¿¡æ¯
4. æ˜¾ç¤ºæŸ¥æ‰¾åˆ°çš„é”€å”®å¾®ä¿¡å·

```javascript
// å…³é”®ä»£ç ï¼ˆè¡Œ304-308ï¼‰
if (order.sales_code) {
  const matchingSale = allSales.find(sale => sale.sales_code === order.sales_code);
  if (matchingSale) {
    salesWechat = matchingSale.wechat_name || '-';
  }
}
```

### 2ï¸âƒ£ è®¢å•ç®¡ç†é¡µé¢ï¼ˆgetOrdersWithFiltersï¼‰

**æ–‡ä»¶**ï¼š`client/src/services/supabase.js` (è¡Œ892-1161)

**é€»è¾‘æµç¨‹**ï¼š
1. è·å–è®¢å•åˆ—è¡¨
2. æ”¶é›†æ‰€æœ‰ `sales_code`ã€`primary_sales_id`ã€`secondary_sales_id`
3. æ‰¹é‡æŸ¥è¯¢é”€å”®ä¿¡æ¯å¹¶å…³è”
4. å¤šé‡åŒ¹é…é€»è¾‘ï¼ˆè¡Œ1102-1116ï¼‰ï¼š
   - ä¼˜å…ˆä½¿ç”¨ `primary_sales_id` åŒ¹é…
   - å…¶æ¬¡ä½¿ç”¨ `secondary_sales_id` åŒ¹é…
   - æœ€åä½¿ç”¨ `sales_code` åŒ¹é…

```javascript
// å…³é”®ä»£ç ï¼ˆè¡Œ1102-1116ï¼‰
if (order.primary_sales_id && primarySalesById.has(order.primary_sales_id)) {
  salesInfo = primarySalesById.get(order.primary_sales_id);
  salesType = 'primary';
} else if (order.secondary_sales_id && secondarySalesById.has(order.secondary_sales_id)) {
  salesInfo = secondarySalesById.get(order.secondary_sales_id);
  salesType = 'secondary';
} else if (order.sales_code) {
  // sales_codeæ˜¯æœ€åçš„åŒ¹é…é€‰é¡¹
}
```

## ğŸ¯ é—®é¢˜æ ¹å› åˆ†æ

### åœºæ™¯è¿˜åŸï¼šfl261247 çš„ç‰¹æ®Šæƒ…å†µ

1. **fl261247 çš„åŒé‡èº«ä»½**ï¼š
   - æ—¢æ˜¯**äºŒçº§é”€å”®**ï¼ˆåœ¨WML792355703ä¸‹ï¼‰
   - åˆæ˜¯**å®¢æˆ·**ï¼ˆè‡ªå·±ä¹Ÿè´­ä¹°äº†äº§å“ï¼‰

2. **è®¢å•æ•°æ®çš„å¯èƒ½æƒ…å†µ**ï¼š
   
   **æƒ…å†µA**ï¼šfl261247é€šè¿‡WML792355703çš„é“¾æ¥è´­ä¹°
   ```javascript
   {
     customer_wechat: "fl261247",
     sales_code: "PRI1754724178064255",  // WML792355703çš„code
     primary_sales_id: 123,               // WML792355703çš„ID
     secondary_sales_id: null
   }
   ```
   
   **æƒ…å†µB**ï¼šfl261247é€šè¿‡è‡ªå·±çš„é“¾æ¥è´­ä¹°
   ```javascript
   {
     customer_wechat: "fl261247",
     sales_code: "SEC1754724178064256",  // fl261247è‡ªå·±çš„code
     primary_sales_id: null,
     secondary_sales_id: 456              // fl261247çš„ID
   }
   ```

3. **ä¸¤ä¸ªé¡µé¢çš„å¤„ç†å·®å¼‚**ï¼š
   - **å®¢æˆ·ç®¡ç†**ï¼šåªçœ‹ `sales_code`ï¼Œå¯èƒ½åŒ¹é…åˆ°fl261247è‡ªå·±
   - **è®¢å•ç®¡ç†**ï¼šä¼˜å…ˆçœ‹ `primary_sales_id`ï¼Œä¼šæ˜¾ç¤ºWML792355703

## âŒ è°æ˜¯é”™çš„ï¼Ÿ

### è®¢å•ç®¡ç†é¡µé¢çš„é€»è¾‘æ˜¯**æ­£ç¡®çš„** âœ…

**ç†ç”±**ï¼š
1. ä½¿ç”¨äº†æ›´ç²¾ç¡®çš„IDåŒ¹é…ï¼ˆ`primary_sales_id`ã€`secondary_sales_id`ï¼‰
2. æœ‰æ˜ç¡®çš„ä¼˜å…ˆçº§é¡ºåº
3. èƒ½å‡†ç¡®åæ˜ è®¢å•çš„å®é™…é”€å”®å½’å±

### å®¢æˆ·ç®¡ç†é¡µé¢çš„é€»è¾‘æœ‰**é—®é¢˜** âŒ

**é—®é¢˜**ï¼š
1. åªä¾èµ– `sales_code` æŸ¥æ‰¾ï¼Œä¸å¤Ÿç²¾ç¡®
2. æ²¡æœ‰è€ƒè™‘ `primary_sales_id` å’Œ `secondary_sales_id`
3. å¯èƒ½é€ æˆé”€å”®å½’å±é”™è¯¯

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆï¼šç»Ÿä¸€å®¢æˆ·ç®¡ç†çš„å–æ•°é€»è¾‘

ä¿®æ”¹ `client/src/services/api.js` çš„ `getCustomers` æ–¹æ³•ï¼Œä½¿ç”¨ä¸è®¢å•ç®¡ç†ç›¸åŒçš„é”€å”®åŒ¹é…é€»è¾‘ï¼š

```javascript
// ä¿®æ”¹getCustomersæ–¹æ³•ï¼ˆè¡Œ299-325ï¼‰
// ä½¿ç”¨ä¸getOrdersWithFiltersç›¸åŒçš„å¤šé‡åŒ¹é…é€»è¾‘

// 1. ä¼˜å…ˆä½¿ç”¨primary_sales_id
if (order.primary_sales_id) {
  const primarySale = primarySalesMap.get(order.primary_sales_id);
  if (primarySale) {
    salesWechat = primarySale.wechat_name;
    salesType = 'primary';
  }
}
// 2. å…¶æ¬¡ä½¿ç”¨secondary_sales_id
else if (order.secondary_sales_id) {
  const secondarySale = secondarySalesMap.get(order.secondary_sales_id);
  if (secondarySale) {
    salesWechat = secondarySale.wechat_name;
    salesType = 'secondary';
  }
}
// 3. æœ€åä½¿ç”¨sales_code
else if (order.sales_code) {
  // åŸæœ‰çš„sales_codeé€»è¾‘
}
```

## ğŸ“‹ éªŒè¯æ­¥éª¤

1. **è¿è¡Œè¯Šæ–­è„šæœ¬**ï¼š
   ```javascript
   // å¤åˆ¶ è¯Šæ–­è®¢å•é”€å”®å…³ç³».js çš„å†…å®¹åˆ°æ§åˆ¶å°è¿è¡Œ
   ```

2. **æ£€æŸ¥ç»“æœ**ï¼š
   - fl261247çš„sales_code
   - è®¢å•ä¸­çš„primary_sales_id
   - å®é™…çš„é”€å”®å½’å±

3. **ç¡®è®¤ä¿®å¤**ï¼š
   - ä¸¤ä¸ªé¡µé¢æ˜¾ç¤ºç›¸åŒçš„é”€å”®ä¿¡æ¯
   - é”€å”®å½’å±å‡†ç¡®æ— è¯¯

## âš ï¸ å½±å“èŒƒå›´

ä¿®å¤åå¯èƒ½å½±å“ï¼š
1. å®¢æˆ·ç®¡ç†é¡µé¢çš„é”€å”®æ˜¾ç¤º
2. é”€å”®ä¸šç»©ç»Ÿè®¡
3. ä½£é‡‘è®¡ç®—ï¼ˆå¦‚æœåŸºäºå®¢æˆ·ç®¡ç†æ•°æ®ï¼‰

## ğŸ’¡ å»ºè®®

1. **çŸ­æœŸä¿®å¤**ï¼šç»Ÿä¸€ä¸¤ä¸ªé¡µé¢çš„å–æ•°é€»è¾‘
2. **é•¿æœŸä¼˜åŒ–**ï¼š
   - åœ¨è®¢å•åˆ›å»ºæ—¶å°±æ˜ç¡®è®°å½•é”€å”®å±‚çº§å…³ç³»
   - é¿å…åæœŸé€šè¿‡sales_codeåæŸ¥
   - å»ºç«‹ç»Ÿä¸€çš„é”€å”®å½’å±åˆ¤æ–­æœåŠ¡
