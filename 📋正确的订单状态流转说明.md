# 📋 正确的订单状态流转说明

## 订单状态定义

### 主流程状态
1. **待付款** (`pending_payment`) - 订单创建后，等待客户付款
2. **已付款** (`confirmed_payment`) - 付款已确认
3. **待配置** (`pending_config`) - 等待配置确认
4. **已完成** (`confirmed_config`) - 配置已确认，订单完成

### 特殊状态
5. **未完成购买** (`incomplete`) - 客户创建订单但未完成购买流程的独立状态
6. **已生效** (`active`) - 订单已生效
7. **已过期** (`expired`) - 订单已过期
8. **已取消** (`cancelled`) - 订单已取消
9. **已拒绝** (`rejected`) - 订单被拒绝

## 正确的状态流转

### 标准付费订单流程
```
待付款 (pending_payment)
├─→ 付款确认 → 已付款 (confirmed_payment)
└─→ 拒绝订单 → 已拒绝 (rejected)

已付款 (confirmed_payment)
├─→ 开始配置 → 待配置 (pending_config)
└─→ 拒绝订单 → 已拒绝 (rejected)

待配置 (pending_config)
├─→ 配置确认 → 已完成 (confirmed_config)
└─→ 拒绝订单 → 已拒绝 (rejected)
```

### 7天免费订单流程
```
待付款 (pending_payment) [创建时]
└─→ 开始配置 → 待配置 (pending_config) [跳过付款]
    ├─→ 配置确认 → 已完成 (confirmed_config)
    └─→ 拒绝订单 → 已拒绝 (rejected)
```

### 未完成购买状态
- **未完成购买** (`incomplete`) 是一个独立的订单状态
- 表示客户创建了订单但没有完成购买流程
- 这是订单本身的状态，不是从其他状态转换来的

## 状态操作按钮

| 当前状态 | 可用操作 |
|----------|----------|
| 待付款 | 付款确认、拒绝订单 |
| 已付款 | 开始配置、拒绝订单 |
| 待配置 | 配置确认、拒绝订单 |
| 已完成 | 无操作（终态）|
| 未完成购买 | 无操作（终态）|
| 已拒绝 | 无操作（终态）|
| 已取消 | 无操作（终态）|

## 注意事项

1. **未完成购买** 是订单的初始状态之一，不是通过按钮操作转换的
2. 所有状态值都在 varchar(20) 限制内
3. 7天免费订单自动跳过付款流程
